<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Оптимизация рекламных кампаний, SEO трафика и любых других источников с помощью метода шести сигм (контрольных карт Шухарта)">

<title>Data Driven Marketing - Применяем ГОСТ стандарт РФ «Контрольные карты Шухарта» для оптимизация рекламных кампаний и других источников трафика</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="../site_libs/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script>
<script src="../site_libs/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script>
<script src="../site_libs/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script>
<script src="../site_libs/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script>
<link href="../site_libs/dt-ext-colreorder-1.13.6/css/colReorder.dataTables.min.css" rel="stylesheet">
<script src="../site_libs/dt-ext-colreorder-1.13.6/js/dataTables.colReorder.min.js"></script>
<link href="../site_libs/dt-ext-fixedheader-1.13.6/css/fixedHeader.dataTables.min.css" rel="stylesheet">
<script src="../site_libs/dt-ext-fixedheader-1.13.6/js/dataTables.fixedHeader.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Driven Marketing</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Поиск"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Переключить навигацию" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Главная</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about/korshakov.html" rel="" target="">
 <span class="menu-text">О себе</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../wiki.html" rel="" target="">
 <span class="menu-text">Wiki</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contacts.html" rel="" target="">
 <span class="menu-text">Контакты</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#вводная.-трагическая.-на-что-мы-смотрим-в-метрике" id="toc-вводная.-трагическая.-на-что-мы-смотрим-в-метрике" class="nav-link active" data-scroll-target="#вводная.-трагическая.-на-что-мы-смотрим-в-метрике">Вводная. Трагическая. На что мы смотрим в Метрике</a></li>
  <li><a href="#кто-этот-такой-ваше-контрольный-карта-шухарта" id="toc-кто-этот-такой-ваше-контрольный-карта-шухарта" class="nav-link" data-scroll-target="#кто-этот-такой-ваше-контрольный-карта-шухарта">Кто этот такой ваше «контрольный карта Шухарта»!?</a></li>
  <li><a href="#какие-задачи-решают-ккш" id="toc-какие-задачи-решают-ккш" class="nav-link" data-scroll-target="#какие-задачи-решают-ккш">Какие задачи решают ККШ</a></li>
  <li><a href="#сфера-применения" id="toc-сфера-применения" class="nav-link" data-scroll-target="#сфера-применения">Сфера применения</a></li>
  <li><a href="#как-работать-с-картами" id="toc-как-работать-с-картами" class="nav-link" data-scroll-target="#как-работать-с-картами">Как работать с картами</a></li>
  <li><a href="#примеры" id="toc-примеры" class="nav-link" data-scroll-target="#примеры">Примеры</a>
  <ul class="collapse">
  <li><a href="#xmr-карты" id="toc-xmr-карты" class="nav-link" data-scroll-target="#xmr-карты">XmR-карты</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Применяем ГОСТ стандарт РФ «Контрольные карты Шухарта» для оптимизация рекламных кампаний и других источников трафика</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Дата публикации</div>
    <div class="quarto-title-meta-contents">
      <p class="date">21 четверг март 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="вводная.-трагическая.-на-что-мы-смотрим-в-метрике" class="level2">
<h2 class="anchored" data-anchor-id="вводная.-трагическая.-на-что-мы-смотрим-в-метрике">Вводная. Трагическая. На что мы смотрим в Метрике</h2>
<p>Запустив рекламные кампании неизбежно наступает момент, когда нужно идти в системы аналитики и искать истину.</p>
<p>Создав отчет система аналитики предлагает нам какой-то такой график.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="shewhart_control_card_ydirect_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Прекрасный график показывает нам нежно розовые столбики в динамике. Но, очень быстро, на ум приходит вопрос: «И что?». А и вправду? Что нам делать с этой информацией. Эта динамика хороша или плоха. Мне стоит переживать что столбик от 15.02. выше чем от 14.02 или может даже от 10.01!? Какие решения я должен принять изучив этот график? Даже если я добавлю различные срезы по типу устройства, регионам, таргетам ситуация не станет яснее.</p>
<p>Тогда, может таблица в помощь.</p>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-5494b816347341406a14" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5494b816347341406a14">{"x":{"filter":"none","vertical":false,"extensions":["Buttons","ColReorder","FixedHeader"],"caption":"<caption style=\"caption-side: top; text-align: left; color: gray;\">\n  <h4>Таблица: Данные по аккунту Директ<\/h4>\n<\/caption>","data":[["2024-01-09","2024-01-10","2024-01-11","2024-01-12","2024-01-13","2024-01-14","2024-01-15","2024-01-16","2024-01-17","2024-01-18"],[1320,3490,3273,2242,376,169,3517,3498,2908,528],[10689,9714,6185,3507,1456,1079,4234,5132,3651,4113],[69,154,114,91,32,18,141,181,170,43],[75,148,108,82,31,15,144,184,170,45],[24,40,17,12,4,3,22,37,29,9],[0,3,1,1,1,0,3,3,4,0],[0,1163,3273,2242,376,0,1172,1166,727,0],[19,23,29,25,12,9,25,19,17,12],[0.6,1.6,1.8,2.6,2.2,1.7,3.3,3.5,4.7,1],[0,1.9,0.9,1.1,3.1,0,2.1,1.7,2.4,0],[1.1,1,0.9,0.9,1,0.8,1,1,1,1],[32,27,15.7,14.6,12.9,20,15.3,20.1,17.1,20]],"container":"<table class=\"display compact nowrap\">\n  <thead>\n    <tr>\n      <th>Date<\/th>\n      <th>Cost<\/th>\n      <th>Impressions<\/th>\n      <th>Clicks<\/th>\n      <th>Sessions<\/th>\n      <th>Bounces<\/th>\n      <th>Goals<\/th>\n      <th>CPA<\/th>\n      <th>CPC<\/th>\n      <th>CTR<\/th>\n      <th>CR<\/th>\n      <th>SR<\/th>\n      <th>BR<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"t","colReorder":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12]},{"name":"Date","targets":0},{"name":"Cost","targets":1},{"name":"Impressions","targets":2},{"name":"Clicks","targets":3},{"name":"Sessions","targets":4},{"name":"Bounces","targets":5},{"name":"Goals","targets":6},{"name":"CPA","targets":7},{"name":"CPC","targets":8},{"name":"CTR","targets":9},{"name":"CR","targets":10},{"name":"SR","targets":11},{"name":"BR","targets":12}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'background':isNaN(parseFloat(value)) || value <= 28.000000 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(10168.000000 - value, 0)/10140.000000 * 100 + '%, #EEC9E5 ' + Math.max(10168.000000 - value, 0)/10140.000000 * 100 + '%)','background-size':'100% 80%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'background':isNaN(parseFloat(value)) || value <= 3.000000 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(599.000000 - value, 0)/596.000000 * 100 + '%, #EEC9E5 ' + Math.max(599.000000 - value, 0)/596.000000 * 100 + '%)','background-size':'100% 80%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[6]; $(this.api().cell(row, 6).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.000000 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(5.000000 - value, 0)/5.000000 * 100 + '%, #EEC9E5 ' + Math.max(5.000000 - value, 0)/5.000000 * 100 + '%)','background-size':'100% 80%','background-repeat':'no-repeat','background-position':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<p>Таблица содержит данные сгруппированы по аккаунту. Некоторые столбцы содержат сумму, а некоторые средние значения, например CTR.</p>
<p>И что? Стало яснее? Система по привлечению трафика работает? Даже подсветив ячейки ясности не принесло.</p>
<p>На основании этих данных многие специалисты, бизнесмены и другие коллеги по опасному бизнесу принимают судьбоносные решения.</p>
<p>Это напоминает бросок кирпича. После тщательной подготовки я бросаю свой кирпичик. Он весело, по параболе, достигает своего апекса. Радостно. Показатели на высоте. И, неизбежно (про неизбежное будет чуть ниже), устремляется вниз. Становится тревожно. Вспотел. Но может так должно быть. Так устроена физика и, по сути, переживать тут не надо.</p>
<p>Чтобы понять когда нужно принимать решения применим силу контрольных карт Шухарта.</p>
</section>
<section id="кто-этот-такой-ваше-контрольный-карта-шухарта" class="level2">
<h2 class="anchored" data-anchor-id="кто-этот-такой-ваше-контрольный-карта-шухарта">Кто этот такой ваше «контрольный карта Шухарта»!?</h2>
<p>Контрольные карты Шухарта (метод шести сигм) — статистический метод, который позволяет оптимизировать / усовершенствовать процессы в компании. В основе метода лежит предположение, что любые динамически меняющиеся во времени показатели могут быть разделены на 2 группы: системные и частные.</p>
<p>Предполагается, что если значение показателя трактуется как неудовлетворительное, то необходимо определиться с корректными методами его исправления, принимая во внимание тот факт, что системные проблемы должны корректироваться системными методами, а частные — частными.</p>
<p>Кроме того, метод используется для оценки повышения / снижения качества управления, предлагая конкретные индикативные показатели, отражающие нарастающую или снижающуюся вариативность процесса (вариативность в концепции рассматривается как главный «враг» эффективности).</p>
<p>Главная задача научиться различать состояния, в которых находится система, а затем решать, что и кому надо с ней делать (или не делать). ККШ — это и есть диагностический инструмент для ответа на вопрос: надо или не надо вмешиваться в систему, и если надо, то кому?</p>
<p>Контрольные карты Шухарта приняты и введены в действие <a href="https://docs.cntd.ru/document/1200025672">Постановлением Госстандарта России от 15 апреля 1999 г. N 127</a></p>
</section>
<section id="какие-задачи-решают-ккш" class="level2">
<h2 class="anchored" data-anchor-id="какие-задачи-решают-ккш">Какие задачи решают ККШ</h2>
<ol type="1">
<li>Главная задача — оптимизация источников трафика по интересующим нас данным. После внесенных изменений в рекламную кампанию (РК) вы практически сразу увидите результат.</li>
<li>Контроль подрядчиков. С помощью контрольных карт вы увидите результаты работ и поймёте, были ли вообще выполнены какие-либо работы.</li>
<li>Аудит рекламных систем.</li>
</ol>
</section>
<section id="сфера-применения" class="level2">
<h2 class="anchored" data-anchor-id="сфера-применения">Сфера применения</h2>
<p>Контрольные карты широко применяются в сферах производства и в меньшей степени в сфере услуг. В нашем случае мы применяем карты для улучшения показателей в рекламных кампаниях. Вообще, ККШ можно применить для улучшения любых показателей в бизнесе, которые накладываются на временной ряд.</p>
<p>В данном кейсе я покажу, как с помощью кода на R можно построить различные типы ККШ на примере действующей рекламной кампании. Тип рекламной кампании, собственно, как и источник не имеют значения, так как анализировать можно практически любые параметры из любых источников, растянутых на временном интервале.</p>
</section>
<section id="как-работать-с-картами" class="level2">
<h2 class="anchored" data-anchor-id="как-работать-с-картами">Как работать с картами</h2>
<p>Возможно четыре состояния, в которых находится любой производственный процесс.</p>
<ul>
<li>Идеальное состояние – процесс управляем и 100% продукции соответствует допускам.</li>
<li>Пороговое состояние – процесс управляем, но не 100% продукции соответствует допускам.</li>
<li>На грани хаоса – процесс неуправляем, хотя вся выпускаемая продукция соответствует допускам.</li>
<li>Состояние хаоса – процесс неуправляем, и периодически производится брак.</li>
</ul>
<p>Энтропия постоянно воздействует на все процессы, вызывая ухудшение качества, разрушение, износ и разрывы, аварии и отказы. Т.е. если не управлять системами привлечения трафика (seo, контекст, smm) они в любом случаи затухнут, просто потому что так работают законы вселенной.</p>
<p><strong>Критерии роста системы</strong></p>
<p>Шухарт и Деминг выделили два критерия которые должны указывать на то, что кампания активно растет:</p>
<ul>
<li>среднеарифметическая растет или снижается в зависимости от параметра;</li>
<li>границы сигмы становятся все более узкими. Сокращая вариативность параметра мы берем управление под контроль.</li>
</ul>
<p><strong>Критерии ухудшения системы</strong></p>
<ul>
<li>средняя арифметическая снижается или растет, если речь идет о негативном параметре;</li>
<li>на протяжении шести и более дней (контрольных интервалов)значения скачут с нарастающей волатильностью;</li>
<li>если несколько дней подряд наблюдается выход за пределы контрольных границ;</li>
<li>если шесть и более дней наблюдается негативная тенденция в значениях (неважно, сверху или снизу). Т.е. значения находятся над или под средней линией.</li>
</ul>
<p>Правила для обнаружения «вышедших из-под контроля» или неслучайных условий:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Western_Electric_rules">Western Electric rules</a></li>
<li><a href="https://en.wikipedia.org/wiki/Nelson_rules">Nelson rules</a></li>
</ul>
</section>
<section id="примеры" class="level2">
<h2 class="anchored" data-anchor-id="примеры">Примеры</h2>
<p>Рассмотрим несколько примеров как выглядят различные типы карт в различных срезах.</p>
<p>Но сначала давайте попробуем сделать какие-то выводы по графикам, которые вы видите в Метрике или в Директе.</p>
<p>Для примера возьмем анализ расходов в разрезе кампаний. Построим столбчатый график с накоплением и график с точками и линиями.</p>
<p>Да, на графике видно, что что-то происходит. Какие-то РК включаются, какие-то выключаются, но стоит ли переживать из-за этого. Что за пик случился 05.02. и что произошло дальше.</p>
<section id="xmr-карты" class="level3">
<h3 class="anchored" data-anchor-id="xmr-карты">XmR-карты</h3>
<p>Карты индивидуальных значений и размахов (<span class="math inline">\(XmR-карты\)</span>) применяются, когда нет возможности сгруппировать данные. Данный тип карт менее точен, чем карты средних значений, однако они полезны при старте рекламных кампаний.</p>
<p>Как видно из названия карт применяются два их вида:</p>
<ul>
<li>карта индивидуальных значений (<span class="math inline">\(X-карта\)</span>). Строится карта в декартовой системе координат, где по оси абсцисс расположены даты, а на оси ординат значения исследуемой метрики.</li>
<li>карта размахов. Размах — это разность между наибольшим и наименьшим значениями и обозначается символом <span class="math inline">\(mR\)</span>. Размах практически не отражает «срединных» значений, поэтому он неэффективен для описания больших массивов данных и используется для описания множеств, число элементов которых не превосходит 15.</li>
</ul>
<p>Рассмотрим mR-карту по всему аккаунту за последние 15 дней.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="shewhart_control_card_ydirect_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Сразу видим что 17.03. наблюдается перерасход средств по аккаунту. Были внесены какие-то действия, которые привели к выходу за границы системых значений. Действительно, в этот день были выставлены новые значения по недельному расходу.</p>
<p>Рассмотрим <span class="math inline">\(X-карту\)</span> индивидуальных значений за весь анализируемый период.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="shewhart_control_card_ydirect_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>На графике за весь период видим заметны выходы за границы системы в</p>
<p>Пересобирем график для большей информативности.</p>
<p>Разумеется мы можем выбрать интересующую нас группу и проверить интересующую нас метрику. Например, на графике ниже видны данные по расходам в разрезе трех объявлений выбранной мною группы.</p>
<p>Допустим меня интересует объявление, которое отображено зеленой линией на графике. Проверим границы по бюджетам, кликам.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>