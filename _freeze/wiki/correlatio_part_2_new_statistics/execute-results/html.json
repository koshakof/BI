{
  "hash": "1892a25b9b41e3623424cc109f784471",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Как выбрать микроцель для обучения стратегии показов объявлений в любой рекламной системе\"\n\nsubtitle: \"Часть 2. Статистика оценок или почему не надо испольлзовать только метод проверки значимости нулевой гипотезы, основанный на p-value.\"\n\nauthor: \"Александр Коршаков\"\n\ncategories: [Реклама, Анализ данных]\n\ndate: \"2024-07-29\"\ndate-format: long\n\n\nformat:\n  html:\n    page-layout: article\n    toc: true\n    toc-location: right\n    fig-width: 10\n    fig-height: 8\n    code-fold: true\n    title-prefix: \"ihourglass\"\n    pagetitle: \"Анализ эффективности микроцелей в рекламных кампаниях\"\n    description-meta: \"Применяем метод статистической оценки для анализа эффективности макро и микроцелей\"\n    author-meta: \"Коршаков Александр\"\n    other-links:\n     - text: \"Wikipedia: Estimation statistics\"\n       href: \"https://en.wikipedia.org/wiki/Estimation_statistics\"\n\n  \nexecute:\n  warning: false\n  message: false\n  error: false\n\n\neditor_options:\n  chunk_output_type: console\n---\n\n\nНапомню, что в [первой части](/wiki/correlatio.html) статьи мы прошли шаги:\n\n1. Подготовка данных к корреляционному анализу.\n2. Корреляционный анализ макро- и микроцелей.\n3. Регрессионный анализ и предективная аналитика.\n4. Сбор данных: обучаем стратегию показов в Яндекс Директ.\n\nДанные собраны. Остался последний шаг — провести post-hoc тест и оценить эффективность обучения стратегии на выбранной микроцели.\n\n:::{.column-page .callout-important title=\"Не пропускайте выход новых статей!\"}\nПодписывайтесь на мой ТГ-канал [DDM & Ads](https://t.me/data_driven_ads)\n:::\n\n\n</br>\n\n\n## Проблема статистики на основе p-value и преимущества оценочных методов\n\nПроверка значимости нулевой гипотезы (Null Hypothesis Significance Testing, NHST) часто применяется в маркетинговых исследованиях, но этот метод ограничен. Он отвечает только на вопрос: «Есть ли эффект?». В экономиках и социальных науках вместо NHST используют оценочные методы. Например, указывают: «средний доход составил 50 000₽ ± 1500₽».\n\n\n::: {.callout-tip collapse=\"true\" title=\"Основные проблемы статистики на основе p-value\"}\n1. **Проблема с интерпретацией p-value**. p-value часто неправильно интерпретируется как вероятность гипотезы или вероятность того, что нулевая гипотеза неверна. На самом деле, p-value — это вероятность наблюдения данных, которые были бы столь же экстремальными, если нулевая гипотеза была верна.\n\n2. **Чувствительность к объёму выборки**. p-value может стать очень маленьким при больших объёмах выборки, даже если эффект, который он измеряет, незначителен с практической точки зрения. Это может привести к ложным заключениям о значимости результатов.\n\n3. **Множественные тесты и проблема множественных сравнений**. При проведении множества тестов на одной выборке вероятность получения хотя бы одного ложного положительного результата увеличивается. Это может привести к увеличению числа ложных положительных результатов (ошибки первого рода).\n\n4. **Отсутствие информации о размере эффекта**. p-value не сообщает о размере эффекта или его практической значимости, а только о том, насколько результаты отклоняются от нулевой гипотезы.\n\n5. **Зависимость от выбранного уровня значимости**. Выбор порогового значения для p-value (например, 0.05) является произвольным и может влиять на интерпретацию результатов. Это может привести к субъективности в принятии решений о значимости.\n\n6. **Игнорирование контекста и практической значимости**. Исследователи могут сосредоточиться только на том, чтобы p-value было ниже уровня значимости, не принимая во внимание контекст исследования или практическую значимость результатов.\n\n7. **Проблемы с повторяемостью**. Результаты, которые основываются только на p-value, могут быть трудно воспроизводимыми. Это связано с тем, что даже небольшие изменения в данных могут значительно повлиять на p-value.\n\nЭти проблемы подчеркивают необходимость использования более комплексных методов статистического анализа, таких как оценка эффектов, доверительные интервалы и байесовские методы, которые могут предоставить более полную картину исследуемых данных.\n:::\n\nОценочные методы более информативны. Они дают не только факт наличия эффекта, но и его величину и вариации. Смещение акцента с NHST на оценку эффектов и доверительных интервалов позволяет принимать более точные и обоснованные решения. Вместо простого факта наличия эффекта от рекламной кампании можно узнать его точные параметры, что помогает эффективнее планировать и оценивать стратегии.\n\n\n::: {.callout-tip collapse=\"true\" title=\"Статистика оценок и её преимущества\"}\nСтатистика оценок, также известная как **оценочные методы** или **методы оценивания**, предлагает несколько ключевых преимуществ по сравнению с традиционными подходами, такими как p-value. Вот основные преимущества:\n\n1. **Предоставляет информацию о размере эффекта**. Оценочные методы дают числовое представление о размере эффекта или его значимости, что позволяет лучше понять практическое значение результатов. Например, оценки могут включать в себя такие метрики, как разница средних значений, коэффициенты корреляции или регрессионные коэффициенты.\n\n2. **Использует доверительные интервалы**. Вместо того чтобы полагаться на p-value, оценочные методы часто используют доверительные интервалы, которые дают диапазон возможных значений для параметра. Это помогает понять точность и надежность оценок.\n\n3. **Учитывает размер выборки и вариацию данных**. Оценочные методы учитывают объем выборки и вариацию данных, что позволяет более точно интерпретировать результаты и избегать переоценки значимости.\n\n4. **Подходит для множественных сравнений**. Методы оценивания могут быть адаптированы для обработки множественных сравнений с использованием корректировок, таких как коррекция Бонферрони или метод ложных открытий (FDR), что снижает риск ложных положительных результатов.\n\n5. **Предоставляет полное представление о данных**. Вместо того чтобы сосредоточиваться на одном числовом значении (p-value), оценочные методы предоставляют полное представление о данных, включая эффекты, их размеры и их вариацию.\n\n6. **Адаптируется к различным типам данных и моделей**. Оценочные методы гибки и могут использоваться для анализа данных различных типов и сложных моделей, таких как линейные и нелинейные модели, модели с несколькими переменными и байесовские модели.\n\n7. **Снижает риск ошибки интерпретации**. Использование оценки и доверительных интервалов может снизить риск ошибок интерпретации, связанных с неправильным пониманием p-value, и дать более ясное представление о значимости и надежности результатов.\n\n8. **Фокус на предсказательной способности**. Оценочные методы могут сосредоточиться на оценке предсказательной способности модели, что важно для практических применений, таких как прогнозирование и принятие решений.\n\nЭти преимущества делают статистику оценок полезным инструментом для более глубокого и точного анализа данных, особенно в ситуациях, когда требуется точное понимание эффектов и их значимости.\n:::\n\nВ этой статье рассмотрим плюсы и минусы графиков на основе p-value. Познакомимся с **оценочным графиком Гарднера-Альтмана**, который приходит на смену устаревшим методам на основе p-value.\n\n\n</br>\n\n\n## Подготовка и обзор данных\n\nПроведем анализ эффективности работы двух микроцелей сравнив результаты с контрольным периодом.\n\n- Анализируемые периоды:\n    1. Контрольный с 01.04.24 по 14.04.24 — период работы стратегии «Максимум кликов».\n    2. Тестовый 1 с 15.04.24 по 28.04.24 — период работы цели «dl6».\n    3. Тестовый 2 с 27.05.24 по 9.06.24  — период работы цели «m6».\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Загрузка библиотек\"}\n# обработка данных\nlibrary(data.table)\nlibrary(dplyr)\n\n# вывод интерактивных таблиц\nlibrary(DT)\n\n# графика\nlibrary(ggplot2)\n\n# статистика на графиках\nlibrary(ggsignif)\n\n# статистика оценок\nlibrary(dabestr)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-81f3a3d1965b3c21b25a\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-81f3a3d1965b3c21b25a\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"extensions\":[\"Buttons\"],\"caption\":\"<caption style=\\\"caption-side: top; text-align: left; color: gray;\\\">\\n  <h4>Таблица: Данные для анализа<\\/h4>\\n<\\/caption>\",\"data\":[[\"2024-04-01\",\"2024-04-02\",\"2024-04-03\",\"2024-04-04\",\"2024-04-05\",\"2024-04-06\",\"2024-04-07\",\"2024-04-08\",\"2024-04-09\",\"2024-04-10\",\"2024-04-11\",\"2024-04-12\",\"2024-04-13\",\"2024-04-14\",\"2024-04-15\",\"2024-04-16\",\"2024-04-17\",\"2024-04-18\",\"2024-04-19\",\"2024-04-20\",\"2024-04-21\",\"2024-04-22\",\"2024-04-23\",\"2024-04-24\",\"2024-04-25\",\"2024-04-26\",\"2024-04-27\",\"2024-04-28\",\"2024-05-27\",\"2024-05-28\",\"2024-05-29\",\"2024-05-30\",\"2024-05-31\",\"2024-06-01\",\"2024-06-02\",\"2024-06-03\",\"2024-06-04\",\"2024-06-05\",\"2024-06-06\",\"2024-06-07\",\"2024-06-08\",\"2024-06-09\"],[2,0,4,2,1,1,0,2,5,1,1,1,3,0,2,4,2,1,0,0,0,2,1,1,0,1,1,0,1,6,1,2,2,1,0,1,3,3,1,0,1,0],[\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\",\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\",\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\",\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\",\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\",\"1 Mon\",\"2 Tue\",\"3 Wed\",\"4 Thu\",\"5 Fri\",\"6 Sat\",\"7 Sun\"],[\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Control\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 1\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\",\"Test 2\"]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>Date<\\/th>\\n      <th>Goals<\\/th>\\n      <th>Day<\\/th>\\n      <th>Per<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"Btpli\",\"language\":{\"url\":\"https://cdn.datatables.net/plug-ins/1.13.6/i18n/ru.json\"},\"buttons\":[\"csv\",\"excel\"],\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1},{\"name\":\"Date\",\"targets\":0},{\"name\":\"Goals\",\"targets\":1},{\"name\":\"Day\",\"targets\":2},{\"name\":\"Per\",\"targets\":3}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n</br>\n\n> **Описательные статистики данных**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n  group_by(Per) %>%\n  summarise(psych::describe(Goals, skew = FALSE)) |> \n  datatable(\n    rownames = FALSE,\n    class   = 'display compact nowrap',\n    options = list(dom  = 't')) |> \n  formatRound(columns = c(4,5,10), digits = 2)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-b8bf334a3876eac27e58\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b8bf334a3876eac27e58\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Control\",\"Test 1\",\"Test 2\"],[1,1,1],[14,14,14],[1.642857142857143,1.071428571428571,1.571428571428571],[1.499083969380217,1.141138818110138,1.603567451474546],[1,1,1],[0,0,0],[5,4,6],[5,4,6],[0.4006470433875636,0.3049821777225916,0.4285714285714286]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>Per<\\/th>\\n      <th>vars<\\/th>\\n      <th>n<\\/th>\\n      <th>mean<\\/th>\\n      <th>sd<\\/th>\\n      <th>median<\\/th>\\n      <th>min<\\/th>\\n      <th>max<\\/th>\\n      <th>range<\\/th>\\n      <th>se<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"t\",\"columnDefs\":[{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":9,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9]},{\"name\":\"Per\",\"targets\":0},{\"name\":\"vars\",\"targets\":1},{\"name\":\"n\",\"targets\":2},{\"name\":\"mean\",\"targets\":3},{\"name\":\"sd\",\"targets\":4},{\"name\":\"median\",\"targets\":5},{\"name\":\"min\",\"targets\":6},{\"name\":\"max\",\"targets\":7},{\"name\":\"range\",\"targets\":8},{\"name\":\"se\",\"targets\":9}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n</br>\n\n\n\n\n## Как понять эффективность микроцели?\n\nСобственно, а как понять, что микроцели сработали лучше, чем контрольный период? Ответ прост: нам нужно сравнить средние значения выборок.\n\nМы можем легко вычислить среднюю разницу в наблюдаемых выборках. Это и есть наша оценка интересующего нас размера генерального эффекта.\n\nНо как мы можем определить точность и уверенность нашей оценки? Можем ли мы понять, как она соотносится со средней генеральной разницей?\n\nМы можем рассчитать 95%-ный ДИ средней разницы, выполнив бутстрап-выборку. [Впервые описанный Брэдли Эфроном](https://projecteuclid.org/journals/annals-of-statistics/volume-7/issue-1/Bootstrap-Methods-Another-Look-at-the-Jackknife/10.1214/aos/1176344552.full), бутстрап - это простая, но мощная техника. Он создает несколько выборок (с заменой) из одного набора наблюдений и рассчитывает размер интересующего эффекта по каждой из этих выборок. Затем бутстрап-выборки величины эффекта можно использовать для определения 95%-ного CI.\n\n::: {.callout-caution collapse=\"true\" title=\"Что нужно учитывать при сравнении средних значений\"}\nСравнение средних значений двух выборок на первый взгляд может показаться простым, но для получения надежных и корректных результатов необходимо учитывать несколько важных факторов:\n\n- **Размер выборки (Sample Size)**:\n    - Большие выборки могут давать более точные оценки среднего значения и его разброса. Малые выборки могут быть подвержены случайным колебаниям, что делает результаты менее надежными.\n\n- **Разброс (Variance)**:\n    - Разброс значений в выборках должен быть учтен, так как даже при одинаковых средних значениях, выборки с различным разбросом могут иметь разные статистические характеристики. \n    \n- **Дисперсия (Variance) и стандартное отклонение (Standard Deviation)**:\n    - Эти показатели показывают степень разброса данных относительно среднего. Сравнение двух средних значений без учета их дисперсий может быть вводящим в заблуждение.\n\n- **Независимость данных (Independence of Data)**:\n    - Выборки должны быть независимыми друг от друга. Если между ними существует зависимость, это необходимо учитывать при анализе.\n\n- **Статистическая значимость (Statistical Significance)**:\n    - Нужно учитывать вероятность того, что наблюдаемые различия в средних значениях возникли случайно. Это обычно проверяется с помощью тестов значимости, таких как t-тест.\n\n- **Конфиденциальные интервалы (Confidence Intervals)**:\n    - Они показывают диапазон, в котором с определенной вероятностью находится истинное среднее значение. Это дает более полное представление о точности оценки.\n\n- **Практическая значимость (Practical Significance)**:\n    - Даже если различие статистически значимо, важно оценить его практическую значимость и влияние на реальную ситуацию.\n\n\nЧто мы можем НЕ учитывать в оценочной статистике (её еще называют «новой статистикой»)\n\n- **Нормальность распределения (Normality of Distribution)**:\n    - Многие статистические тесты предполагают, что данные распределены нормально. Если это не так, могут потребоваться непараметрические методы или преобразование данных.\n    - В новом подходе мы многократно извлекаем выборку из ген. совокупности (5 000 раз), что дает нормальное распределение средних значений.\n    \n- **Уровень значимости (Significance Level, p-value)**:\n    - Определяет вероятность того, что наблюдаемые различия являются случайными. Обычно используются пороговые значения, такие как 0.05.\n\n- **Типы ошибок (Types of Errors)**:\n    - Ошибка первого рода (Type I Error): Отказ от нулевой гипотезы, когда она верна.\n    - Ошибка второго рода (Type II Error): Принятие нулевой гипотезы, когда она ложна.\n:::\n\nНо сначала рассмотрим стандартные графики, на основе которых специалисты принимают решение о результатах тестирования.\n\n\n\n\n### Гистограмма со звёздочкой\n\n> **Гистограмма средних значений co звёздочкой**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# вычисление средних значений и стандартных ошибок\nsummary_data <- data |>\n  _[, .(\n    mean = mean(Goals),\n    se = sd(Goals) / sqrt(.N)),\n    by = Per\n    ]\n\n# создание barplot для первого периода\nggplot(\n  summary_data, \n  aes(x = Per, y = mean, fill = Per)\n  ) +\n  geom_bar(\n    stat = \"identity\", \n    position = position_dodge(),\n    width = 0.7\n    ) +\n  geom_errorbar(\n    aes(ymin = mean - se, ymax = mean + se), \n    width = 0.2, \n    position = position_dodge(0.7)\n    ) +\n  scale_fill_manual(\n    values = c(\n      \"Control\" = \"#17BECF\", \n      \"Test 1\" = \"#E377C2\",\n      \"Test 2\" = \"#9467BD\"\n      )) +\n  theme_minimal() +\n  labs(\n    x = \"Group\", \n    y = \"Mean Value\") +\n  theme(\n    legend.position = \"none\",\n    axis.title = element_text(size = 12, color = \"gray50\"),\n    axis.text = element_text(size = 10, color = \"gray50\"),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      ))+\n  geom_signif(\n    comparisons = list(\n      c(\"Control\", \"Test 1\"),\n      c(\"Control\", \"Test 2\")),\n    map_signif_level = TRUE\n    )\n```\n\n::: {.cell-output-display}\n![](correlatio_part_2_new_statistics_files/figure-html/barplot-1.png){width=960}\n:::\n:::\n\n\nЧто мы видим на этом графике?\n\n- средние значения с учетом стандартной ошибки (SE)\n- выводы о значимости «p-value». В нашем случаи на графике мы видим значение «NS», означает, что значение «p-value» не достигает уровня значимости, часто принимаемого как 0.05, то есть p >= 0.05.\n\n**Что мы НЕ видим?**\n\n- График не показывает **конкретные данные**, используемые для его построения, что затрудняет понимание вариабельности данных.\n- Неизвестно, насколько сильно **отличаются средние значения** между группами. Это важно для интерпретации значимости различий.\n- Непонятно, насколько точно **оценен размер эффекта**, что может быть важно для понимания достоверности различий.\n- График не показывает **доверительный интервал** (CI) или вероятность того, что размер эффекта истинный. Это важно для интерпретации надежности результата.\n- Создает **ложную дихотомию** с «звездочкой значимости». – Использование звездочки для обозначения значимости может создать впечатление, что различия либо значимы, либо нет, игнорируя степень и важность этих различий. Это упрощает сложность данных и создает ложное представление о результатах. \n\n\n::: {.callout-tip collapse=\"true\" title=\"Ложная дихотомия\"}\nЛожная дихотомия, или ложная дилемма, в статистике и логике – это ошибка рассуждения, при которой представляется ситуация, как будто существует только два взаимоисключающих варианта, хотя на самом деле их может быть больше. В контексте статистики ложная дихотомия может приводить к неверным выводам и анализу данных.\n\nПримеры ложной дихотомии:\n\n- «Либо данные показывают, что эффект существует, либо они не показывают ничего.» Это утверждение игнорирует возможность того, что данные могут быть недостаточно мощными для выявления эффекта.\n\n- «Либо корреляция равна нулю, либо она значительна.» В реальности существуют значения корреляции, которые могут быть слабыми и незначительными, но все же не нулевыми.\n\nВажно избегать ложной дихотомии при анализе данных, чтобы не упрощать сложные ситуации и не упускать важные детали, которые могут оказать влияние на результаты и выводы исследования.\n:::\n\n\n### Boxplot\n\nИспользуем прямоугольную диаграмму (boxplot) для визуализации данных.\n\n> **График: Boxplot**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# включаем отображение текста на графике\n# showtext_auto()\n\nggplot(\n  data, \n  aes(\n    x = Per, \n    y = Goals,\n    fill = Per\n    )\n  ) + \n  geom_boxplot(outlier.colour = \"tomato2\") + \n  scale_fill_manual(\n    values = c(\n      \"Control\" = \"#17BECF\", \n      \"Test 1\" = \"#E377C2\",\n      \"Test 2\" = \"#9467BD\"\n      )) +\n  theme_minimal()+\n  labs(\n    x = \"Group\",\n    color = NULL\n    )+\n  theme(\n    legend.position = \"none\",\n    axis.title = element_text(size = 14, color = \"gray50\", family = \"roboto\"),\n    axis.text = element_text(size = 12, color = \"gray50\", family = \"roboto\"),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      ))+\n  geom_signif(\n    comparisons = list(\n      c(\"Control\", \"Test 1\"),\n      c(\"Control\", \"Test 2\")),\n    map_signif_level = TRUE\n    )\n```\n\n::: {.cell-output-display}\n![](correlatio_part_2_new_statistics_files/figure-html/boxplot-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# отключаем отображение текста на графике\n# showtext_auto(FALSE)\n```\n:::\n\n\nЧто мы видим на графике boxplot?\n\n- медиану, квартили, выбросы, минимальное и максимальное значение;\n- выводы о значимости «p-value». \n\nНа диаграмме по-прежнему отображаются не все данные. Нам по-прежнему не хватает информации о базовом распределении данных. Они распределены нормально? Есть ли перекос в точках? Каков размер выборки? Что еще более важно, на диаграммах не отображается размер эффекта.\n\n\n### Jitter plot\n\nДля отображения нескольких точек данных по одной или нескольким категориям мы можем использовать график «Jitter».\n\n> **График: Jitter plot**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  data, \n  aes(\n    x = Per, \n    y = Goals,\n    colour = Per\n    )\n  ) + \n  geom_jitter() + \n  scale_color_manual(\n    values = c(\n      \"Control\" = \"#17BECF\", \n      \"Test 1\" = \"#E377C2\",\n      \"Test 2\" = \"#9467BD\"\n      )) +\n  theme_minimal()+\n  labs(\n    x = \"Group\",\n    color = NULL\n    )+\n  theme(\n    legend.position = \"none\",\n    axis.title = element_text(size = 10, color = \"gray50\"),\n    axis.text = element_text(size = 9, color = \"gray50\"),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      ))+\n  geom_signif(\n    comparisons = list(\n      c(\"Control\", \"Test 1\"),\n      c(\"Control\", \"Test 2\")),\n    map_signif_level = TRUE, \n    color =\"black\"\n    )\n```\n\n::: {.cell-output-display}\n![](correlatio_part_2_new_statistics_files/figure-html/jitter plot-1.png){width=960}\n:::\n:::\n\n\nГрафики «дрожания» позволяют избежать перекрытия точек данных (т. е. точек данных с одинаковым значением по оси «y») путем добавления случайного коэффициента к каждой точке вдоль ортогональных осей «x». Таким образом, хотя график дрожания отображает все точки данных (неявно указывая визуально размер выборки), он может неточно отображать базовое распределение данных.\n\nИ по-прежнему мы видим не все, что нам необходимо для принятия решения о внедрении микроцели для обучения стратегии.\n\n\n:::{.column-page .callout-important title=\"Есть проект, в котором я буду полезен?\"}\nОбращайтесь! [Контакты](/contacts.html)\n:::\n\n</br>\n\n## График Гарднера-Альтмана\n\nТеперь мы создадим график без проблем, о которых говорилось ранее.\n\nС помощью пакета «dabest» мы сгенерируем данные о средних значениях и создадим 95% доверительный интервал методом бутстрапа, используя 5000 выборок.\n\nБутстрап-выборка даёт нам два важных преимущества:\n\n- **Непараметрический статистический анализ.** Не нужно предполагать, что наши данные или базовые популяции имеют нормальное распределение. Согласно центральной предельной теореме, распределение размера эффекта при повторной выборке будет приближаться к нормальному.\n\n- **Легко построить 95% доверительный интервал на основе распределения выборки**. Для 1000 бутстреп-выборок средних разниц можно использовать 25-ю и 95-ю разницы в ранжированном списке как границы 95% доверительного интервала. Этот тип интервала называется интервалом перцентиля.\n\n\n> **Оценочный график Гарднера-Альтмана**\n\n\n::: {.cell .column-body-outset}\n\n```{.r .cell-code}\n# подготовка данных к проведению теста 1\ndabest_obj_1 <- data |> \n  dabestr::load(\n    x = Per,\n    y = Goals,\n    idx = c(\"Control\", \"Test 1\")\n  ) |> \n  mean_diff()\n\n# подготовка данных к проведению теста 2\ndabest_obj_2 <- data |> \n  dabestr::load(\n    x = Per,\n    y = Goals,\n    idx = c(\"Control\", \"Test 2\")\n  ) |> \n  mean_diff()\n\n\n# создаем график для Тест 1\nplot_dabest_obj_1 <- dabest_plot(\n  dabest_obj_1, \n  float_contrast = TRUE, \n  custom_palette = \"npg\"\n  )\n\n# создаем график для Тест 2\nplot_dabest_obj_2 <- dabest_plot(\n  dabest_obj_2, \n  float_contrast = TRUE, \n  custom_palette = \"npg\"\n  )\n\n# выводим графики в одну строку и две колонки\ncowplot::plot_grid(\n  plotlist = list(plot_dabest_obj_1, plot_dabest_obj_2),\n  nrow = 1,\n  ncol = 2,\n  labels = \"AUTO\"\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_part_2_new_statistics_files/figure-html/view plot with dabest obj-1.png){width=960}\n:::\n:::\n\n\n\nГрафик оценки имеет две ключевые особенности:\n\n1. Все точки данных представлены в виде роевой диаграммы, которая упорядочивает каждую точку для отображения основного распределения.\n\n2. Величина эффекта представлена в виде бутстрепного 95% доверительного интервала (95% CI) на отдельных, но выровненных осях, где величина эффекта отображается справа от исходных данных, а среднее значение тестовой группы выравнивается с величиной эффекта.\n\n\nВ результате проведенных тестов мы получим следующий вывод для Control и Test 1:\n\n>The unpaired mean difference between Test 1 and Control is -0.571 [95%CI -1.571, 0.357].\nThe p-value of the two-sided permutation t-test is 0.3036, calculated for legacy purposes only.\n5000 bootstrap samples were taken; the confidence interval is bias-corrected and accelerated.\nAny p-value reported is the probability of observing the effect size (or greater),\nassuming the null hypothesis of zero difference is true.\nFor each p-value, 5000 reshuffles of the control and test labels were performed.\n\n> **Таблица статистик для графика A: Контрольные и Тестовый 1 (цель «dl6»)**\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-2a4eeeb510bc0b97b0e4\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-2a4eeeb510bc0b97b0e4\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Control\"],[\"Test 1\"],[5000],[-1.571428571428572],[0.357142857142857],[-1.571428571428571],[0.3571428571428572],[95],[-0.5714285714285714],[0.5634674922600619]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>control_group<\\/th>\\n      <th>test_group<\\/th>\\n      <th>nboots<\\/th>\\n      <th>bca_ci_low<\\/th>\\n      <th>bca_ci_high<\\/th>\\n      <th>pct_ci_low<\\/th>\\n      <th>pct_ci_high<\\/th>\\n      <th>ci<\\/th>\\n      <th>difference<\\/th>\\n      <th>weight<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"t\",\"columnDefs\":[{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":8,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":9,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6,7,8,9]},{\"name\":\"control_group\",\"targets\":0},{\"name\":\"test_group\",\"targets\":1},{\"name\":\"nboots\",\"targets\":2},{\"name\":\"bca_ci_low\",\"targets\":3},{\"name\":\"bca_ci_high\",\"targets\":4},{\"name\":\"pct_ci_low\",\"targets\":5},{\"name\":\"pct_ci_high\",\"targets\":6},{\"name\":\"ci\",\"targets\":7},{\"name\":\"difference\",\"targets\":8},{\"name\":\"weight\",\"targets\":9}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\",\"options.columnDefs.4.render\",\"options.columnDefs.5.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n</br>\n\nИ выводы для Control и Test 2:\n\n>The unpaired mean difference between Test 2 and Control is -0.071 [95%CI -1.143, 1.071].\nThe p-value of the two-sided permutation t-test is 0.8483, calculated for legacy purposes only.\n5000 bootstrap samples were taken; the confidence interval is bias-corrected and accelerated.\nAny p-value reported is the probability of observing the effect size (or greater),\nassuming the null hypothesis of zero difference is true.\nFor each p-value, 5000 reshuffles of the control and test labels were performed.\n\n> **Таблица статистик для графика B: Контрольные и Тестовый 2 (цель «m6»)**\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-ec8f4630d0bec340fed2\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ec8f4630d0bec340fed2\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Control\"],[\"Test 2\"],[5000],[-1.142857142857143],[1.071428571428571],[-1.142857142857143],[1.071428571428571],[95],[-0.0714285714285714],[0.4150513112884834]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>control_group<\\/th>\\n      <th>test_group<\\/th>\\n      <th>nboots<\\/th>\\n      <th>bca_ci_low<\\/th>\\n      <th>bca_ci_high<\\/th>\\n      <th>pct_ci_low<\\/th>\\n      <th>pct_ci_high<\\/th>\\n      <th>ci<\\/th>\\n      <th>difference<\\/th>\\n      <th>weight<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"t\",\"columnDefs\":[{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":8,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":9,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6,7,8,9]},{\"name\":\"control_group\",\"targets\":0},{\"name\":\"test_group\",\"targets\":1},{\"name\":\"nboots\",\"targets\":2},{\"name\":\"bca_ci_low\",\"targets\":3},{\"name\":\"bca_ci_high\",\"targets\":4},{\"name\":\"pct_ci_low\",\"targets\":5},{\"name\":\"pct_ci_high\",\"targets\":6},{\"name\":\"ci\",\"targets\":7},{\"name\":\"difference\",\"targets\":8},{\"name\":\"weight\",\"targets\":9}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\",\"options.columnDefs.4.render\",\"options.columnDefs.5.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n</br>\n\nПереведем на человеческий на примере контрольной и тестовой выборки 1.\n\nРезультаты:\n\n1. **The unpaired mean difference between Test 1 and Control is -0.571 [95%CI -1.571, 0.357].**\n    - **Unpaired mean difference:** Это средняя разница между двумя группами (Test 1 и Control). В данном случае, средняя разница составляет -0.571, что означает, что в среднем значения в группе Test 1 на 0.571 меньше, чем в группе Control.\n    - **95%CI [-1.571, 0.357]:** Это 95% доверительный интервал для средней разницы. Это означает, что мы уверены на 95%, что истинная средняя разница между группами лежит в интервале от -1.571 до 0.357.\n\n\n2. **The p-value of the two-sided permutation t-test is 0.3036, calculated for legacy purposes only.**\n    - **P-value:** Это вероятность получить наблюдаемую разницу (или более экстремальную), если на самом деле между группами нет разницы (нулевая гипотеза верна). В данном случае, p-value составляет 0.3036.\n    - **Two-sided permutation t-test:** Это тип статистического теста, используемый для сравнения двух групп. Он оценивает, есть ли значимая разница между ними.\n    - **Legacy purposes:** Это означает, что p-value предоставлен для исторической значимости, но основное внимание уделяется другим метрикам (например, доверительным интервалам).\n\n\n3. **5000 bootstrap samples were taken; the confidence interval is bias-corrected and accelerated**.\n    - **Bootstrap samples:** Это метод повторной выборки, который позволяет оценить распределение статистики (например, средней разницы). В данном случае было взято 5000 выборок.\n    - **Bias-corrected and accelerated:** Это тип коррекции доверительного интервала, который улучшает точность оценки.\n\n\n4. **Any p-value reported is the probability of observing the effect size (or greater), assuming the null hypothesis of zero difference is true.**\n    - **P-value:** Это вероятность получить наблюдаемую разницу (или более экстремальную), если между группами на самом деле нет разницы (нулевая гипотеза верна).\n\n\n5. **For each p-value, 5000 reshuffles of the control and test labels were performed.**\n    - **Reshuffles**: Это перестановки меток групп (Control и Test 1) для оценки распределения p-value. В данном случае было выполнено 5000 перестановок.\n\n\n**Вывод для цели «dl6»**\n\nСредняя разница между группами Test 1 и Control составляет -0.571. Доверительный интервал показывает, что истинная разница может лежать в диапазоне от -1.571 до 0.357. P-value составляет 0.3036, что означает, что наблюдаемая разница не является статистически значимой (мы не можем уверенно сказать, что есть разница между группами). Эти результаты основаны на 5000 повторных выборках и перестановках.\n\nНа основании данных нельзя с уверенностью сказать, что между группами Test 1 и Control существует значимая разница. Однако, доверительный интервал предоставляет полезную информацию о возможном диапазоне истинной разницы.\n\n**Вывод для цели «m6»**\n\nСредняя разница между группами Test 2 и Control составляет -0.071. Доверительный интервал показывает, что истинная разница может лежать в диапазоне от -1.143 до 1.071. P-value составляет 0.8483, что означает, что наблюдаемая разница не является статистически значимой (мы не можем уверенно сказать, что есть разница между группами). Эти результаты основаны на 5000 повторных выборках и перестановках.\n\nНа основании данных нельзя с уверенностью сказать, что между группами Test 2 и Control существует значимая разница. Однако, доверительный интервал предоставляет полезную информацию о возможном диапазоне истинной разницы.\n\n\n## Итог\n\nНа основе проведенных тестов мы можем смело заключить, что ни одна микроцель не подходит для обучения стратегии показов рекламных объявлений. Значит, продолжаем искать новые микроцели, но до тех пор показываем рекламу по стратегии «Максимум кликов».\n\n:::{.column-page .callout-important title=\"Есть проект, в котором я буду полезен?\"}\n\n- Обращайтесь! [Контакты](/contacts.html)\n\n- Подписывайтесь на мой ТГ-канал [DDM & Ads](https://t.me/data_driven_ads)\n:::",
    "supporting": [
      "correlatio_part_2_new_statistics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<script src=\"../site_libs/jszip-1.13.6/jszip.min.js\"></script>\n<link href=\"../site_libs/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.html5.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.print.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}