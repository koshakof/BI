{
  "hash": "3b0a53b5a92afbdcd86b689f4332896d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Как выбрать микроцель для обучения стратегии показов объявлений в любой рекламной системе\"\nsubtitle: \"Часть 1. Корреляция и регрессия. Подробный разбор методологии с примерами\"\nauthor: \"Александр Коршаков\"\n\ncategories: [Реклама, Анализ данных]\n\ndate: \"2024-05-23\"\ndate-format: long\n\nformat:\n  html:\n    page-layout: article\n    toc: true\n    toc-location: right\n    fig-width: 10\n    fig-height: 8\n    code-fold: true\n    other-links:\n     - text: Код JS цели «dl*»\n       href: \"https://disk.yandex.ru/d/qjabnXIB_qafig\"\n    title-prefix: \"ihourglass\"\n    pagetitle: \"Как выбрать микроцель для обучения рекламных систем\"\n    description-meta: \"Подбираем микроцель методами статистического анализа\"\n    author-meta: \"Коршаков Александр\"\n\nexecute:\n  warning: false\n  message: false\n  error: false\n---\n\n\n<!-- Чанки для пред. настроек -->\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Код: Загрузка библиотек\"}\n# обработка данных\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(tibble)\nlibrary(ggpubr)\n\n# отображение таблиц\nlibrary(DT)\nlibrary(gt)\n\n# графика\nlibrary(ggplot2)\nlibrary(plotly)\n\n# объединение графиков\nlibrary(patchwork)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#|echo: false\n\n# настройки для отображения текста на кирилице\nlibrary(showtext)\nshowtext_opts(dpi = 200)\nshowtext_auto()\n```\n:::\n\n<!-- END -->\n\n\n\n**Для кого**\n\nСерия статей из двух частей, посвященная теме корреляционного анализа, будет полезна специалистам, которые имеют опыт ведения рекламных кампаний и знакомы с основами статистики (и я имею в виду статистику, ту, что «Ложь, большая ложь и статистика», а не интерфейс в «Директе»).\n\nНачинающие специалисты смогут изучить методологию и понять, с чего начать.\n\nЕсть возможность скачать таблицу с данными и воспроизвести процесс по шагам с помощью примеров (и такой-то матери) либо собственными силами в Excel.\n\n[Хорошая статья на эту же тему от команды Яндекса, в которой показаны примеры работы с данными в Excel](https://vc.ru/marketing/1119868-vse-chto-vam-nuzhno-znat-o-korrelyacionnom-analize-v-kontekstnoy-reklame-i-dazhe-bolshe)\n\n::: {#thanks .callout-tip appearance=\"simple\" title=\"Благодарность\"}\nБлагодарю [Полину Бондареву](https://t.me/pbondareva) за код для целей «dl*». Код можно скачать, перейдя по ссылке в левом верхнем углу страницы под основными ссылками.\n:::\n\n:::{.callout-important title=\"ТГ-канал DDM&Ads\"}\nПодписывайтесь на мой ТГ-канал [DDM & Ads](https://t.me/data_driven_ads)\n:::\n\n</br>\n\n\n## Введение\n\n**Проблема**\n\nВ контексте рекламных кампаний в нишах B2B и сложных продуктов существует проблема с количеством обращений от потенциальных клиентов (лидов). Лиды поступают нестабильно и в небольшом количестве, что не позволяет обучить рекламную систему для достижения основных целей: звонки, отправка формы, обращение через виджеты. Даже если создать общую цель, которая объединяет все основные цели, их все равно может быть недостаточно.\n\n\n**Решение**\n\nОдин из вариантов решения задачи — это обучение стратегии на микроцелях: просмотр страниц, время, проведенное на сайте, и специальные цели, которые передаются через собственный JavaScript-код.  \n\nГлавные требования к микроцелям: \n\n- микроцелей должно быть *гораздо больше, чем макроцелей, и поступают они равномерно*. Чем больше, тем лучше. Насколько именно больше покажет регрессионная модель, но для первичного отбора целей обратимся к таблице из [справки Директа](https://yandex.ru/support/direct/strategies/average-cpa.html).\n\n\n::: {.cell .tbl-column-body-outset}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ivvypbuxas\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ivvypbuxas table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ivvypbuxas thead, #ivvypbuxas tbody, #ivvypbuxas tfoot, #ivvypbuxas tr, #ivvypbuxas td, #ivvypbuxas th {\n  border-style: none;\n}\n\n#ivvypbuxas p {\n  margin: 0;\n  padding: 0;\n}\n\n#ivvypbuxas .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ivvypbuxas .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ivvypbuxas .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ivvypbuxas .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ivvypbuxas .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ivvypbuxas .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ivvypbuxas .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ivvypbuxas .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ivvypbuxas .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ivvypbuxas .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ivvypbuxas .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ivvypbuxas .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ivvypbuxas .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ivvypbuxas .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ivvypbuxas .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ivvypbuxas .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ivvypbuxas .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ivvypbuxas .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ivvypbuxas .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ivvypbuxas .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ivvypbuxas .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ivvypbuxas .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ivvypbuxas .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ivvypbuxas .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ivvypbuxas .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ivvypbuxas .gt_left {\n  text-align: left;\n}\n\n#ivvypbuxas .gt_center {\n  text-align: center;\n}\n\n#ivvypbuxas .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ivvypbuxas .gt_font_normal {\n  font-weight: normal;\n}\n\n#ivvypbuxas .gt_font_bold {\n  font-weight: bold;\n}\n\n#ivvypbuxas .gt_font_italic {\n  font-style: italic;\n}\n\n#ivvypbuxas .gt_super {\n  font-size: 65%;\n}\n\n#ivvypbuxas .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ivvypbuxas .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ivvypbuxas .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ivvypbuxas .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ivvypbuxas .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ivvypbuxas .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ivvypbuxas .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ivvypbuxas .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ivvypbuxas div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Конверсии\">Конверсии</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Отклонение от истинного значения\">Отклонение от истинного значения</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Цена конверсии\">Цена конверсии</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Конверсии\" class=\"gt_row gt_left\">&lt; 25</td>\n<td headers=\"Отклонение от истинного значения\" class=\"gt_row gt_left\">± 20%</td>\n<td headers=\"Цена конверсии\" class=\"gt_row gt_left\">± 40%</td></tr>\n    <tr><td headers=\"Конверсии\" class=\"gt_row gt_left\">&lt; 100</td>\n<td headers=\"Отклонение от истинного значения\" class=\"gt_row gt_left\">± 10%</td>\n<td headers=\"Цена конверсии\" class=\"gt_row gt_left\">± 20%</td></tr>\n    <tr><td headers=\"Конверсии\" class=\"gt_row gt_left\">&lt; 400</td>\n<td headers=\"Отклонение от истинного значения\" class=\"gt_row gt_left\">± 5%</td>\n<td headers=\"Цена конверсии\" class=\"gt_row gt_left\">± 10%</td></tr>\n    <tr><td headers=\"Конверсии\" class=\"gt_row gt_left\">&lt; 2500</td>\n<td headers=\"Отклонение от истинного значения\" class=\"gt_row gt_left\">± 2%</td>\n<td headers=\"Цена конверсии\" class=\"gt_row gt_left\">± 4%</td></tr>\n    <tr><td headers=\"Конверсии\" class=\"gt_row gt_left\">&lt; 10 000</td>\n<td headers=\"Отклонение от истинного значения\" class=\"gt_row gt_left\">± 1%</td>\n<td headers=\"Цена конверсии\" class=\"gt_row gt_left\">± 2%</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n- Микроцели имеют *статистически значимую* корреляцию с главными целями. О статистической значимости часто не упоминают на вебинарах, а это очень важно. \n\n::: {.callout-tip collapse=\"true\" title=\"Примечание о стат значимости\"}\nСтатистическая значимость связана с ошибкой первого рода — найти подтверждение там, где её нет в реальности. За данную ошибку отвечает уровень достоверности — альфа ($\\alpha$) и в тестах он обозначается как $\\text{p-value}$.\n\n$\\text{p-value} < 0.05$ означает, что вероятность найти такие или еще более значимые отличия равна $5\\%$, т. е. в $5$ случаях из $100$ мы можем ошибиться.\n:::\n\n- Микроцель и макроцель имеют *линейную взаимосвязь*, при этом микроцель влияет на макроцель, а не наоборот (что логично).\n\n\n\n\n## Как проводится исследование\n\nНиже перечислены шаги, как в целом проходит все исследование, от настройки до проверки результатов:\n\n1. Выбрать и настроить микроцели в Метрике.\n2. Собрать данные в течение 25–30 дней.\n3. Провести корреляционный анализ и найти микроцель.\n4. Провести регрессионный анализ и найти уровень объясненной дисперсии и предсказать значения по главной цели.\n5. Запустить проверку гипотезы: обучаем стратегию показов. Срок — 1–2 недели.\n\n::: {.callout-important title=\"Важный шаг!\"}\n6. Провести Post-hoc тест, чтобы убедиться, что результаты обучения стратегии статистически значимы и действительно отличаются от периода до обучения стратегии.\n:::\n\nПервая часть статьи посвящена вопросам корреляционного и регрессионного анализов. Следующая часть будет полностью посвящена шестому шагу. Данная статья начинается с третьего шага, т. е. микроцели настроены и данные собраны.\n\n\n\n\n## Обзор данных\n\n\n::: {.cell}\n\n:::\n\n\nРассмотрим типы целей, которые участвуют в анализе.\n\n\n::: {.cell .tbl-column-page}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"hfvhfkeejt\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hfvhfkeejt table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hfvhfkeejt thead, #hfvhfkeejt tbody, #hfvhfkeejt tfoot, #hfvhfkeejt tr, #hfvhfkeejt td, #hfvhfkeejt th {\n  border-style: none;\n}\n\n#hfvhfkeejt p {\n  margin: 0;\n  padding: 0;\n}\n\n#hfvhfkeejt .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: small;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hfvhfkeejt .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hfvhfkeejt .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hfvhfkeejt .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hfvhfkeejt .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hfvhfkeejt .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hfvhfkeejt .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hfvhfkeejt .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hfvhfkeejt .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hfvhfkeejt .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hfvhfkeejt .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hfvhfkeejt .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hfvhfkeejt .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hfvhfkeejt .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hfvhfkeejt .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hfvhfkeejt .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hfvhfkeejt .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hfvhfkeejt .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hfvhfkeejt .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hfvhfkeejt .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hfvhfkeejt .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hfvhfkeejt .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hfvhfkeejt .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hfvhfkeejt .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hfvhfkeejt .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hfvhfkeejt .gt_left {\n  text-align: left;\n}\n\n#hfvhfkeejt .gt_center {\n  text-align: center;\n}\n\n#hfvhfkeejt .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hfvhfkeejt .gt_font_normal {\n  font-weight: normal;\n}\n\n#hfvhfkeejt .gt_font_bold {\n  font-weight: bold;\n}\n\n#hfvhfkeejt .gt_font_italic {\n  font-style: italic;\n}\n\n#hfvhfkeejt .gt_super {\n  font-size: 65%;\n}\n\n#hfvhfkeejt .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hfvhfkeejt .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hfvhfkeejt .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hfvhfkeejt .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hfvhfkeejt .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hfvhfkeejt .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hfvhfkeejt .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#hfvhfkeejt .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#hfvhfkeejt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Глоссарий по макро- и микроцелям</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"5\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Главные цели\">\n        <span class=\"gt_column_spanner\">Главные цели</span>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Микроцели\">\n        <span class=\"gt_column_spanner\">Микроцели</span>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Goals\">Goals</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Calls\">Calls</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"B24\">B24</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Forms\">Forms</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"eMails\">eMails</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"page*\">page*</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"min*\">min*</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl*\">dl*</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Goals\" class=\"gt_row gt_left\">Сумма главных целей (Calls + B24 + Forms + eMails)</td>\n<td headers=\"Calls\" class=\"gt_row gt_left\">Звонок</td>\n<td headers=\"B24\" class=\"gt_row gt_left\">Отправка сообщения через виджит Б24</td>\n<td headers=\"Forms\" class=\"gt_row gt_left\">Отправка формы с сайта</td>\n<td headers=\"eMails\" class=\"gt_row gt_left\">Клик или копирование email</td>\n<td headers=\"page*\" class=\"gt_row gt_left\">Просмотрено 2, 3, 4 страницы</td>\n<td headers=\"min*\" class=\"gt_row gt_left\">Проведено на сайте от 3, 6, 8 минут</td>\n<td headers=\"dl*\" class=\"gt_row gt_left\">Специальная многосоставная JS цель</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nРассмотрим таблицу с данными по макро- и микроцелям.\n\n\n::: {.cell .tbl-column-page}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-8d4a64f870ab892b63f8\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-8d4a64f870ab892b63f8\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"extensions\":[\"Buttons\"],\"caption\":\"<caption style=\\\"caption-side: top; text-align: left;\\\">\\n  <h6>Таблица: Данные по микро- и макроцелям с 01.01.2024<\\/h6>\\n<\\/caption>\",\"data\":[[\"2024-01-10\",\"2024-01-11\",\"2024-01-15\",\"2024-01-16\",\"2024-01-17\",\"2024-01-18\",\"2024-01-19\",\"2024-01-20\",\"2024-01-22\",\"2024-01-23\",\"2024-01-24\",\"2024-01-25\",\"2024-01-26\",\"2024-01-28\",\"2024-01-29\",\"2024-01-30\",\"2024-02-01\",\"2024-02-03\",\"2024-02-05\",\"2024-02-06\",\"2024-02-07\",\"2024-02-08\",\"2024-02-09\",\"2024-02-11\",\"2024-02-12\",\"2024-02-13\",\"2024-02-15\",\"2024-02-16\",\"2024-02-17\",\"2024-02-19\",\"2024-02-20\",\"2024-02-21\",\"2024-02-22\",\"2024-02-23\",\"2024-02-24\",\"2024-02-25\",\"2024-02-26\",\"2024-02-27\",\"2024-02-28\",\"2024-02-29\",\"2024-03-01\",\"2024-03-02\",\"2024-03-03\",\"2024-03-04\",\"2024-03-05\",\"2024-03-06\",\"2024-03-07\",\"2024-03-08\",\"2024-03-09\",\"2024-03-10\",\"2024-03-11\",\"2024-03-12\",\"2024-03-13\",\"2024-03-14\",\"2024-03-15\",\"2024-03-16\",\"2024-03-17\",\"2024-03-18\",\"2024-03-19\",\"2024-03-20\",\"2024-03-21\",\"2024-03-22\",\"2024-03-23\",\"2024-03-24\",\"2024-03-25\",\"2024-03-26\",\"2024-03-27\",\"2024-03-28\",\"2024-03-29\",\"2024-03-30\",\"2024-03-31\",\"2024-04-01\",\"2024-04-02\",\"2024-04-03\",\"2024-04-04\",\"2024-04-05\",\"2024-04-06\",\"2024-04-07\",\"2024-04-08\",\"2024-04-09\",\"2024-04-10\",\"2024-04-11\",\"2024-04-12\",\"2024-04-13\",\"2024-04-14\",\"2024-04-15\"],[2,0,0,0,1,0,0,2,1,2,1,0,0,0,4,null,1,null,1,1,0,1,0,0,0,0,0,1,0,null,null,1,null,null,null,1,null,null,1,1,4,null,0,1,0,null,1,null,0,null,0,1,null,null,0,1,0,4,3,0,1,1,1,0,1,2,2,1,0,0,null,null,null,0,2,null,0,0,0,null,2,1,null,1,null,0],[0,1,0,1,0,1,0,1,0,0,0,0,1,2,0,null,1,null,0,1,1,0,1,1,1,0,1,0,1,null,null,0,null,null,null,1,null,null,0,1,0,null,2,0,2,null,0,null,0,null,0,0,null,null,1,0,0,0,0,0,1,0,0,0,2,0,1,0,1,0,null,null,null,1,0,null,2,1,0,null,1,0,null,0,null,1],[2,0,3,0,0,0,1,0,0,0,0,1,0,0,0,null,0,null,2,0,0,0,0,0,0,0,1,0,0,null,null,0,null,null,null,0,null,null,0,0,0,null,0,0,1,null,0,null,0,null,0,0,null,null,0,0,1,0,1,1,0,0,0,2,0,0,0,0,0,0,null,null,null,0,1,null,0,0,2,null,0,0,null,0,null,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,null,0,null,0,0,0,0,0,0,0,1,7,1,0,null,null,0,null,null,null,0,null,null,0,0,0,null,0,0,0,null,0,null,1,null,2,0,null,null,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,null,null,null,0,0,null,0,0,0,null,0,0,null,0,null,0],[4,1,3,2,1,1,1,3,1,2,1,1,1,2,4,null,2,null,3,2,1,1,1,1,1,1,9,2,1,null,null,1,null,null,null,2,null,null,1,2,4,null,2,1,3,null,1,null,1,null,2,1,null,null,1,1,1,4,4,1,2,1,1,2,3,3,3,2,1,1,null,null,null,1,3,null,2,1,2,null,3,1,null,1,null,1],[null,null,1,null,null,null,null,null,null,1,2,null,null,null,1,null,null,1,null,null,null,2,null,null,null,null,6,1,null,1,null,null,null,5,21,10,9,8,9,7,17,18,9,21,17,13,11,8,9,10,14,14,13,13,15,8,10,21,17,15,12,12,7,7,16,18,20,13,9,12,7,15,10,7,16,16,15,5,15,11,11,8,14,15,6,8],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,3,1,null,1,null,null,null,1,2,2,1,4,5,4,7,5,2,6,12,9,8,5,5,6,10,7,9,7,10,4,3,8,12,11,5,6,4,7,10,10,14,11,4,8,4,11,7,5,7,8,9,3,8,8,4,5,8,12,3,4],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,null,null,2,null,2,3,1,3,3,2,3,7,5,7,3,3,1,8,5,6,4,6,1,2,6,9,8,5,4,3,6,8,5,9,8,2,5,3,6,4,3,6,5,5,2,4,8,3,3,4,11,3,3],[null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,1,null,null,null,null,null,2,2,4,null,null,6,null,null,1,2,5,3,17,62,35,53,2,7,12,20,23,16,20,10,12,9,11,8,5,12,11,15,5,7,4,10,18,17,3,7,2,7,12,12,11,11,8,5,6,5,7,11,6,11,7,8,8,19,4,10,7,20,10,7,2],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,6,null,null,null,2,4,1,7,19,12,20,1,4,4,9,10,8,6,3,3,5,6,3,1,7,6,7,5,4,2,5,8,9,3,5,2,3,4,8,7,5,7,3,3,4,5,6,5,5,2,5,3,15,1,7,4,13,6,3,1],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,3,null,null,null,1,4,1,6,16,8,16,1,2,3,7,8,4,5,null,null,3,3,2,1,2,6,5,4,4,1,4,5,8,3,4,1,3,3,6,6,3,6,2,2,4,4,4,5,5,1,4,null,13,1,5,2,11,5,2,1],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,1,null,1,null,null,null,1,null,null,null,null,10,1,null,1,null,2,null,null,6,16,19,18,27,15,45,45,18,48,25,21,26,17,20,15,28,29,32,28,28,24,23,40,35,22,31,20,22,19,31,38,28,26,19,20,20,26,26,20,33,24,29,17,31,18,25,14,22,25,20,16],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,1,null,1,null,null,null,1,null,null,null,null,8,1,null,1,null,1,null,null,3,9,10,12,21,11,30,27,10,30,21,18,20,12,14,7,21,24,25,25,24,19,16,32,29,17,22,18,15,15,24,32,24,21,17,16,16,19,19,17,25,18,25,15,23,15,19,10,16,19,15,13],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,7,1,null,1,null,1,null,null,2,6,6,12,15,8,25,19,9,22,16,16,17,6,9,2,14,19,21,20,19,15,12,25,24,14,16,14,15,13,20,26,19,16,10,14,13,16,13,15,24,15,21,12,20,14,14,8,16,19,12,10],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,7,1,null,1,null,1,null,null,2,5,6,8,10,6,19,15,7,19,14,15,12,3,7,2,13,13,17,15,18,12,11,19,21,14,13,11,11,10,19,21,16,15,9,12,8,13,11,13,18,10,15,7,15,9,12,7,11,16,11,10],[null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,7,1,null,1,null,null,null,null,2,4,5,5,7,3,15,9,6,14,10,13,9,2,6,2,12,11,16,11,17,9,8,17,19,12,11,9,9,10,15,14,13,13,6,10,8,9,7,10,17,8,11,6,13,9,7,7,10,12,9,9],[null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,7,1,null,1,null,null,null,null,2,4,2,3,6,3,10,8,5,8,8,10,6,2,5,1,11,10,12,9,14,8,7,14,14,9,8,8,7,10,14,13,10,13,6,9,6,6,7,7,12,7,8,6,10,5,5,7,8,10,6,6],[null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,6,1,null,1,null,null,null,null,2,3,2,2,4,3,7,6,5,7,7,8,6,2,5,1,9,9,12,8,11,6,6,11,13,9,7,6,6,8,13,11,9,12,2,9,6,6,4,7,11,4,6,5,10,4,2,6,8,10,5,5],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,5,1,null,1,null,null,null,null,1,3,2,2,2,3,7,6,3,6,7,6,5,2,5,1,8,8,11,7,11,5,5,8,12,9,7,6,5,7,11,8,8,12,2,8,5,5,3,7,9,2,4,5,10,4,2,6,8,9,5,5],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,5,1,null,1,null,null,null,null,1,3,2,2,2,3,3,4,3,6,7,4,5,1,4,1,6,6,10,4,8,5,4,7,11,8,6,4,3,6,9,6,7,10,2,7,3,4,2,4,7,2,5,5,9,4,2,5,5,8,4,5],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,1,null,null,null,1,null,null,null,null,5,null,null,1,null,null,null,null,1,3,1,2,2,2,3,4,3,6,7,2,5,1,4,1,6,5,8,4,7,3,4,5,9,8,6,3,2,6,8,5,5,9,2,7,3,4,2,3,7,2,5,5,7,3,2,4,4,8,4,3]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>Date<\\/th>\\n      <th>Calls<\\/th>\\n      <th>B24<\\/th>\\n      <th>Forms<\\/th>\\n      <th>EMails<\\/th>\\n      <th>Goals<\\/th>\\n      <th>page2<\\/th>\\n      <th>page3<\\/th>\\n      <th>page4<\\/th>\\n      <th>min3<\\/th>\\n      <th>min6<\\/th>\\n      <th>min8<\\/th>\\n      <th>dl1<\\/th>\\n      <th>dl2<\\/th>\\n      <th>dl3<\\/th>\\n      <th>dl4<\\/th>\\n      <th>dl5<\\/th>\\n      <th>dl6<\\/th>\\n      <th>dl7<\\/th>\\n      <th>dl8<\\/th>\\n      <th>dl9<\\/th>\\n      <th>dl10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"buttons\":[\"csv\",\"excel\"],\"pageLength\":10,\"dom\":\"Btpli\",\"language\":{\"url\":\"//cdn.datatables.net/plug-ins/1.13.6/i18n/ru.json\"},\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#7B7B7B', 'color': '#fff'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]},{\"name\":\"Date\",\"targets\":0},{\"name\":\"Calls\",\"targets\":1},{\"name\":\"B24\",\"targets\":2},{\"name\":\"Forms\",\"targets\":3},{\"name\":\"EMails\",\"targets\":4},{\"name\":\"Goals\",\"targets\":5},{\"name\":\"page2\",\"targets\":6},{\"name\":\"page3\",\"targets\":7},{\"name\":\"page4\",\"targets\":8},{\"name\":\"min3\",\"targets\":9},{\"name\":\"min6\",\"targets\":10},{\"name\":\"min8\",\"targets\":11},{\"name\":\"dl1\",\"targets\":12},{\"name\":\"dl2\",\"targets\":13},{\"name\":\"dl3\",\"targets\":14},{\"name\":\"dl4\",\"targets\":15},{\"name\":\"dl5\",\"targets\":16},{\"name\":\"dl6\",\"targets\":17},{\"name\":\"dl7\",\"targets\":18},{\"name\":\"dl8\",\"targets\":19},{\"name\":\"dl9\",\"targets\":20},{\"name\":\"dl10\",\"targets\":21}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n</br>\n\nВ таблице видно много пустых ячеек. Проверим по колонкам кол-во пропущенных значений.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# проверка на NA по столбцам\nna_df <- df |> \n  reframe(\n    across(\n      where(is.numeric), \n      list(na = function(x, ...) sum(is.na(x)))\n      )\n    )\n\n# строим график для анализа NA\nna_df_plt <- na_df |> \n  pivot_longer(\n    cols = ends_with(\"na\"),\n    names_to = \"Name\",\n    values_to = \"Value\"\n  ) |> \n  ggplot(aes(x = Name, y = Value)) +\n  geom_col(fill = '#ff79c6') +\n  \n  theme_minimal() +\n  \n  labs(\n    title = \"NA значения в разрезе целей\",\n    x = NULL,\n    y = \"Кол-во целей\"\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 8, color = \"gray50\"),\n    axis.text.x = element_text(angle = 90),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n\n# создаем интерактивный график\nplotly::ggplotly(na_df_plt)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-3808436916ddd8b14bec\" style=\"width:100%;height:520px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3808436916ddd8b14bec\">{\"x\":{\"data\":[{\"orientation\":\"v\",\"width\":[0.90000000000000013,0.89999999999999991,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.90000000000000036],\"base\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"x\":[2,1,14,13,15,19,20,21,16,17,18,3,5,6,7,8,9,10,11,12,4],\"y\":[22,22,22,22,22,24,25,32,23,27,30,24,24,25,25,26,27,27,28,28,29],\"text\":[\"Name: Calls_na<br />Value: 22\",\"Name: B24_na<br />Value: 22\",\"Name: Forms_na<br />Value: 22\",\"Name: EMails_na<br />Value: 22\",\"Name: Goals_na<br />Value: 22\",\"Name: page2_na<br />Value: 24\",\"Name: page3_na<br />Value: 25\",\"Name: page4_na<br />Value: 32\",\"Name: min3_na<br />Value: 23\",\"Name: min6_na<br />Value: 27\",\"Name: min8_na<br />Value: 30\",\"Name: dl1_na<br />Value: 24\",\"Name: dl2_na<br />Value: 24\",\"Name: dl3_na<br />Value: 25\",\"Name: dl4_na<br />Value: 25\",\"Name: dl5_na<br />Value: 26\",\"Name: dl6_na<br />Value: 27\",\"Name: dl7_na<br />Value: 27\",\"Name: dl8_na<br />Value: 28\",\"Name: dl9_na<br />Value: 28\",\"Name: dl10_na<br />Value: 29\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,121,198,1)\",\"line\":{\"width\":1.8897637795275593,\"color\":\"transparent\"}},\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":46.113452505858938,\"r\":11.338582677165356,\"b\":65.646868861193099,\"l\":36.245182926231358},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"title\":{\"text\":\"NA значения в разрезе целей\",\"font\":{\"color\":\"rgba(102,102,102,1)\",\"family\":\"\",\"size\":15.940224159402243},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,21.600000000000001],\"tickmode\":\"array\",\"ticktext\":[\"B24_na\",\"Calls_na\",\"dl1_na\",\"dl10_na\",\"dl2_na\",\"dl3_na\",\"dl4_na\",\"dl5_na\",\"dl6_na\",\"dl7_na\",\"dl8_na\",\"dl9_na\",\"EMails_na\",\"Forms_na\",\"Goals_na\",\"min3_na\",\"min6_na\",\"min8_na\",\"page2_na\",\"page3_na\",\"page4_na\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,14.999999999999998,15.999999999999998,17,18,19,20,21],\"categoryorder\":\"array\",\"categoryarray\":[\"B24_na\",\"Calls_na\",\"dl1_na\",\"dl10_na\",\"dl2_na\",\"dl3_na\",\"dl4_na\",\"dl5_na\",\"dl6_na\",\"dl7_na\",\"dl8_na\",\"dl9_na\",\"EMails_na\",\"Forms_na\",\"Goals_na\",\"min3_na\",\"min6_na\",\"min8_na\",\"page2_na\",\"page3_na\",\"page4_na\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816},\"tickangle\":-90,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-1.6000000000000001,33.600000000000001],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"10\",\"20\",\"30\"],\"tickvals\":[0,10,20,30],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"10\",\"20\",\"30\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Кол-во целей\",\"font\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716894984}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"ec879910add\":{\"x\":{},\"y\":{},\"type\":\"bar\"}},\"cur_data\":\"ec879910add\",\"visdat\":{\"ec879910add\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nВ данном примере дополнительные микроцели были настроены в конце февраля. Рассмотрим на графике, когда данные начали поступать стабильно и в достаточном кол-ве.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# преобразуем данные в длинный форма\nplot_df <- df |> \n    pivot_longer(\n    cols = 2:ncol(df),\n    names_to = \"Name\",\n    values_to = \"Value\"\n    )\n\n\n# строим график\nggplot(\n    plot_df, \n    aes(\n      x = Date , \n      y = Value, \n      group = Name, \n      fill = Name)\n    ) +\n  \n  geom_col(na.rm = TRUE) +\n  \n    scale_x_date(\n    date_breaks = \"2 day\", \n    date_labels = \"%d.%m\"\n    ) +\n    \n   theme_minimal() +\n  \n  labs(\n    title = \"Данные по целям поступают в нормальном объяёме с 24.02.24\",\n    x = NULL,\n    y = \"Кол-во целей\",\n    fill = NULL\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 14, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 7, color = \"gray50\"),\n    axis.text.x = element_text(angle = 90),\n    panel.grid = element_blank(),\n    legend.position = \"top\",\n    legend.justification = \"left\",\n    legend.box.spacing = unit(0.1, \"cm\"),\n    legend.text = element_text(size = 8, color = \"gray50\"), \n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/plot goals-1.png){width=960}\n:::\n:::\n\n\nДанные начинают поступать в нормальном объеме с $24.02.24$. Значит, сократим данные, взяв старт с указанной даты и до конца периода.\n\n**Вывод**\n\n- Необходимо уменьшить объем данных и производить расчеты с даты стабильного поступления микроконверсий.\n- Заменить оставшиеся значение *NA* на $0$. \n\n::: {.callout-caution collapse=\"true\" title=\"Замена *NA* не всегда может быть верным решением.\"}\nНеобходимо учитывать контекст ситуации. Важно понимать, чем объясняется появление пропущенных значений. В нашем случае *NA* значения в главных целях образовались в результате обработки данных и говорят они о том, что в эти дни были достигнуты микроконверсии, но не было главных целей. Поэтому удалить пропущенные значения в этом случае мы не можем, заменим на 0. \n\nИ ситуация, когда есть макроцель, но нет микроцели, нежелательна. Это говорит о том, что данные по микроцелям не поступали в эти дни. Такие строки можно удалить.\n:::\n\n\n\n## Препроцессинг данных\n\nУменьшим объем данных.\n\n\n::: {.cell .tbl-column-page}\n\n```{.r .cell-code}\nsf <- df |> \n  filter(Date >= \"2024-02-24\")\n\ndatatable(\n  sf,\n  rownames = FALSE,\n  class = 'display compact nowrap',\n  options = list(\n    buttons = c('csv', 'excel'),\n    pageLength = 10,\n    dom = 'Btpli',\n    language   = list(url = '//cdn.datatables.net/plug-ins/1.13.6/i18n/ru.json'),\n    initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#7B7B7B', 'color': '#fff'});\",\n    \"}\")\n    ),\n  caption = htmltools::tags$caption(\n    style = 'caption-side: top; text-align: left;',\n    htmltools::h6('Таблица: Уменьшили кол-во NA значений')\n    )\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-5fd679ab50d82c3e57d5\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5fd679ab50d82c3e57d5\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"caption\":\"<caption style=\\\"caption-side: top; text-align: left;\\\">\\n  <h6>Таблица: Уменьшили кол-во NA значений<\\/h6>\\n<\\/caption>\",\"data\":[[\"2024-02-24\",\"2024-02-25\",\"2024-02-26\",\"2024-02-27\",\"2024-02-28\",\"2024-02-29\",\"2024-03-01\",\"2024-03-02\",\"2024-03-03\",\"2024-03-04\",\"2024-03-05\",\"2024-03-06\",\"2024-03-07\",\"2024-03-08\",\"2024-03-09\",\"2024-03-10\",\"2024-03-11\",\"2024-03-12\",\"2024-03-13\",\"2024-03-14\",\"2024-03-15\",\"2024-03-16\",\"2024-03-17\",\"2024-03-18\",\"2024-03-19\",\"2024-03-20\",\"2024-03-21\",\"2024-03-22\",\"2024-03-23\",\"2024-03-24\",\"2024-03-25\",\"2024-03-26\",\"2024-03-27\",\"2024-03-28\",\"2024-03-29\",\"2024-03-30\",\"2024-03-31\",\"2024-04-01\",\"2024-04-02\",\"2024-04-03\",\"2024-04-04\",\"2024-04-05\",\"2024-04-06\",\"2024-04-07\",\"2024-04-08\",\"2024-04-09\",\"2024-04-10\",\"2024-04-11\",\"2024-04-12\",\"2024-04-13\",\"2024-04-14\",\"2024-04-15\"],[null,1,null,null,1,1,4,null,0,1,0,null,1,null,0,null,0,1,null,null,0,1,0,4,3,0,1,1,1,0,1,2,2,1,0,0,null,null,null,0,2,null,0,0,0,null,2,1,null,1,null,0],[null,1,null,null,0,1,0,null,2,0,2,null,0,null,0,null,0,0,null,null,1,0,0,0,0,0,1,0,0,0,2,0,1,0,1,0,null,null,null,1,0,null,2,1,0,null,1,0,null,0,null,1],[null,0,null,null,0,0,0,null,0,0,1,null,0,null,0,null,0,0,null,null,0,0,1,0,1,1,0,0,0,2,0,0,0,0,0,0,null,null,null,0,1,null,0,0,2,null,0,0,null,0,null,0],[null,0,null,null,0,0,0,null,0,0,0,null,0,null,1,null,2,0,null,null,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,null,null,null,0,0,null,0,0,0,null,0,0,null,0,null,0],[null,2,null,null,1,2,4,null,2,1,3,null,1,null,1,null,2,1,null,null,1,1,1,4,4,1,2,1,1,2,3,3,3,2,1,1,null,null,null,1,3,null,2,1,2,null,3,1,null,1,null,1],[21,10,9,8,9,7,17,18,9,21,17,13,11,8,9,10,14,14,13,13,15,8,10,21,17,15,12,12,7,7,16,18,20,13,9,12,7,15,10,7,16,16,15,5,15,11,11,8,14,15,6,8],[2,2,1,4,5,4,7,5,2,6,12,9,8,5,5,6,10,7,9,7,10,4,3,8,12,11,5,6,4,7,10,10,14,11,4,8,4,11,7,5,7,8,9,3,8,8,4,5,8,12,3,4],[null,2,null,2,3,1,3,3,2,3,7,5,7,3,3,1,8,5,6,4,6,1,2,6,9,8,5,4,3,6,8,5,9,8,2,5,3,6,4,3,6,5,5,2,4,8,3,3,4,11,3,3],[62,35,53,2,7,12,20,23,16,20,10,12,9,11,8,5,12,11,15,5,7,4,10,18,17,3,7,2,7,12,12,11,11,8,5,6,5,7,11,6,11,7,8,8,19,4,10,7,20,10,7,2],[19,12,20,1,4,4,9,10,8,6,3,3,5,6,3,1,7,6,7,5,4,2,5,8,9,3,5,2,3,4,8,7,5,7,3,3,4,5,6,5,5,2,5,3,15,1,7,4,13,6,3,1],[16,8,16,1,2,3,7,8,4,5,null,null,3,3,2,1,2,6,5,4,4,1,4,5,8,3,4,1,3,3,6,6,3,6,2,2,4,4,4,5,5,1,4,null,13,1,5,2,11,5,2,1],[6,16,19,18,27,15,45,45,18,48,25,21,26,17,20,15,28,29,32,28,28,24,23,40,35,22,31,20,22,19,31,38,28,26,19,20,20,26,26,20,33,24,29,17,31,18,25,14,22,25,20,16],[3,9,10,12,21,11,30,27,10,30,21,18,20,12,14,7,21,24,25,25,24,19,16,32,29,17,22,18,15,15,24,32,24,21,17,16,16,19,19,17,25,18,25,15,23,15,19,10,16,19,15,13],[2,6,6,12,15,8,25,19,9,22,16,16,17,6,9,2,14,19,21,20,19,15,12,25,24,14,16,14,15,13,20,26,19,16,10,14,13,16,13,15,24,15,21,12,20,14,14,8,16,19,12,10],[2,5,6,8,10,6,19,15,7,19,14,15,12,3,7,2,13,13,17,15,18,12,11,19,21,14,13,11,11,10,19,21,16,15,9,12,8,13,11,13,18,10,15,7,15,9,12,7,11,16,11,10],[2,4,5,5,7,3,15,9,6,14,10,13,9,2,6,2,12,11,16,11,17,9,8,17,19,12,11,9,9,10,15,14,13,13,6,10,8,9,7,10,17,8,11,6,13,9,7,7,10,12,9,9],[2,4,2,3,6,3,10,8,5,8,8,10,6,2,5,1,11,10,12,9,14,8,7,14,14,9,8,8,7,10,14,13,10,13,6,9,6,6,7,7,12,7,8,6,10,5,5,7,8,10,6,6],[2,3,2,2,4,3,7,6,5,7,7,8,6,2,5,1,9,9,12,8,11,6,6,11,13,9,7,6,6,8,13,11,9,12,2,9,6,6,4,7,11,4,6,5,10,4,2,6,8,10,5,5],[1,3,2,2,2,3,7,6,3,6,7,6,5,2,5,1,8,8,11,7,11,5,5,8,12,9,7,6,5,7,11,8,8,12,2,8,5,5,3,7,9,2,4,5,10,4,2,6,8,9,5,5],[1,3,2,2,2,3,3,4,3,6,7,4,5,1,4,1,6,6,10,4,8,5,4,7,11,8,6,4,3,6,9,6,7,10,2,7,3,4,2,4,7,2,5,5,9,4,2,5,5,8,4,5],[1,3,1,2,2,2,3,4,3,6,7,2,5,1,4,1,6,5,8,4,7,3,4,5,9,8,6,3,2,6,8,5,5,9,2,7,3,4,2,3,7,2,5,5,7,3,2,4,4,8,4,3]],\"container\":\"<table class=\\\"display compact nowrap\\\">\\n  <thead>\\n    <tr>\\n      <th>Date<\\/th>\\n      <th>Calls<\\/th>\\n      <th>B24<\\/th>\\n      <th>Forms<\\/th>\\n      <th>EMails<\\/th>\\n      <th>Goals<\\/th>\\n      <th>page2<\\/th>\\n      <th>page3<\\/th>\\n      <th>page4<\\/th>\\n      <th>min3<\\/th>\\n      <th>min6<\\/th>\\n      <th>min8<\\/th>\\n      <th>dl1<\\/th>\\n      <th>dl2<\\/th>\\n      <th>dl3<\\/th>\\n      <th>dl4<\\/th>\\n      <th>dl5<\\/th>\\n      <th>dl6<\\/th>\\n      <th>dl7<\\/th>\\n      <th>dl8<\\/th>\\n      <th>dl9<\\/th>\\n      <th>dl10<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"buttons\":[\"csv\",\"excel\"],\"pageLength\":10,\"dom\":\"Btpli\",\"language\":{\"url\":\"//cdn.datatables.net/plug-ins/1.13.6/i18n/ru.json\"},\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#7B7B7B', 'color': '#fff'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]},{\"name\":\"Date\",\"targets\":0},{\"name\":\"Calls\",\"targets\":1},{\"name\":\"B24\",\"targets\":2},{\"name\":\"Forms\",\"targets\":3},{\"name\":\"EMails\",\"targets\":4},{\"name\":\"Goals\",\"targets\":5},{\"name\":\"page2\",\"targets\":6},{\"name\":\"page3\",\"targets\":7},{\"name\":\"page4\",\"targets\":8},{\"name\":\"min3\",\"targets\":9},{\"name\":\"min6\",\"targets\":10},{\"name\":\"min8\",\"targets\":11},{\"name\":\"dl1\",\"targets\":12},{\"name\":\"dl2\",\"targets\":13},{\"name\":\"dl3\",\"targets\":14},{\"name\":\"dl4\",\"targets\":15},{\"name\":\"dl5\",\"targets\":16},{\"name\":\"dl6\",\"targets\":17},{\"name\":\"dl7\",\"targets\":18},{\"name\":\"dl8\",\"targets\":19},{\"name\":\"dl9\",\"targets\":20},{\"name\":\"dl10\",\"targets\":21}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n</br>\n\nУ нас остается 52 строки наблюдений, что вполне достаточно для анализа. Проверяем на кол-во пропущенных значений.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# проверка на NA по столбцам\nna_df <- sf |> \n  reframe(\n    across(\n      where(is.numeric), \n      list(na = function(x, ...) sum(is.na(x)))\n      )\n    ) |> \n  select(-c(Calls_na, B24_na, Forms_na, EMails_na))\n\n# строим график для анализа NA\nna_df_plt <- na_df |> \n  pivot_longer(\n    cols = ends_with(\"na\"),\n    names_to = \"Name\",\n    values_to = \"Value\"\n  ) |> \n  ggplot(aes(x = Name, y = Value)) +\n  geom_col(fill = '#ff79c6') +\n  \n  theme_minimal() +\n  \n  labs(\n    title = \" NA значения по целям\",\n    x = NULL,\n    y = \"Кол-во целей\"\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 8, color = \"gray50\"),\n    axis.text.x = element_text(angle = 90),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n\n# создаем интерактивный график\nplotly::ggplotly(na_df_plt)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-45e8a0b8a2363f6557b0\" style=\"width:100%;height:520px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-45e8a0b8a2363f6557b0\">{\"x\":{\"data\":[{\"orientation\":\"v\",\"width\":[0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999991,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858,0.89999999999999858,0.90000000000000013],\"base\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"x\":[11,15,16,17,12,13,14,1,3,4,5,6,7,8,9,10,2],\"y\":[16,0,0,2,0,0,3,0,0,0,0,0,0,0,0,0,0],\"text\":[\"Name: Goals_na<br />Value: 16\",\"Name: page2_na<br />Value:  0\",\"Name: page3_na<br />Value:  0\",\"Name: page4_na<br />Value:  2\",\"Name: min3_na<br />Value:  0\",\"Name: min6_na<br />Value:  0\",\"Name: min8_na<br />Value:  3\",\"Name: dl1_na<br />Value:  0\",\"Name: dl2_na<br />Value:  0\",\"Name: dl3_na<br />Value:  0\",\"Name: dl4_na<br />Value:  0\",\"Name: dl5_na<br />Value:  0\",\"Name: dl6_na<br />Value:  0\",\"Name: dl7_na<br />Value:  0\",\"Name: dl8_na<br />Value:  0\",\"Name: dl9_na<br />Value:  0\",\"Name: dl10_na<br />Value:  0\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,121,198,1)\",\"line\":{\"width\":1.8897637795275593,\"color\":\"transparent\"}},\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":46.113452505858938,\"r\":11.338582677165356,\"b\":60.333460808059016,\"l\":36.245182926231358},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"title\":{\"text\":\" NA значения по целям\",\"font\":{\"color\":\"rgba(102,102,102,1)\",\"family\":\"\",\"size\":15.940224159402243},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,17.600000000000001],\"tickmode\":\"array\",\"ticktext\":[\"dl1_na\",\"dl10_na\",\"dl2_na\",\"dl3_na\",\"dl4_na\",\"dl5_na\",\"dl6_na\",\"dl7_na\",\"dl8_na\",\"dl9_na\",\"Goals_na\",\"min3_na\",\"min6_na\",\"min8_na\",\"page2_na\",\"page3_na\",\"page4_na\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],\"categoryorder\":\"array\",\"categoryarray\":[\"dl1_na\",\"dl10_na\",\"dl2_na\",\"dl3_na\",\"dl4_na\",\"dl5_na\",\"dl6_na\",\"dl7_na\",\"dl8_na\",\"dl9_na\",\"Goals_na\",\"min3_na\",\"min6_na\",\"min8_na\",\"page2_na\",\"page3_na\",\"page4_na\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816},\"tickangle\":-90,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-0.80000000000000004,16.800000000000001],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"5\",\"10\",\"15\"],\"tickvals\":[0,5,10,15],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"5\",\"10\",\"15\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.6529680365296811,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Кол-во целей\",\"font\":{\"color\":\"rgba(127,127,127,1)\",\"family\":\"\",\"size\":10.62681610626816}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716894984}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"ec83010ebf2\":{\"x\":{},\"y\":{},\"type\":\"bar\"}},\"cur_data\":\"ec83010ebf2\",\"visdat\":{\"ec83010ebf2\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n</br>\n\nТак намного лучше. У нас всего по 2 пропущенных значения в микроцелях, что не критично.\n\nСгруппируем данные по неделям и найдем подходящие цели: те, что в кол-ве больше 100, подойдут лучше всего. Группируем по неделям, так как опираемся на рекомендации Яндекса по кол-ву целей для обучения системы. \n\n\n::: {.cell .tbl-column-page}\n\n```{.r .cell-code}\nsf <- df |> \n  filter(Date >= \"2024-02-24\")\n\nmicro_sf <- sf |> \n  mutate(Week = clock::date_format(Date, format = \"%W\")) |> \n  reframe(\n    across(c(2:ncol(sf)), ~sum(., na.rm = TRUE)),\n    .by = c(Week)\n    ) %>% \n  select(1,7:ncol(sf)) |> \n  slice(2:6)\n\ngt(\n  micro_sf, \n  rowname_col = \"Week\"\n  ) |> \n  tab_header(\n    title = \"Подходящие микроцели группы dl*\",\n    subtitle = \"Сгруппированные данные по неделям\"\n  ) |> \n  data_color(\n    columns = 1:ncol(micro_sf),\n    fn = \\(v) lapply(v, \\(x) if (x < 30) \"darkred\" else if (x > 100) \"darkgreen\" else \"grey\"),\n    apply_to = \"text\"\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"nkeyqljldy\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#nkeyqljldy table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#nkeyqljldy thead, #nkeyqljldy tbody, #nkeyqljldy tfoot, #nkeyqljldy tr, #nkeyqljldy td, #nkeyqljldy th {\n  border-style: none;\n}\n\n#nkeyqljldy p {\n  margin: 0;\n  padding: 0;\n}\n\n#nkeyqljldy .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#nkeyqljldy .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#nkeyqljldy .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#nkeyqljldy .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#nkeyqljldy .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#nkeyqljldy .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#nkeyqljldy .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#nkeyqljldy .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#nkeyqljldy .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#nkeyqljldy .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#nkeyqljldy .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#nkeyqljldy .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#nkeyqljldy .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#nkeyqljldy .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#nkeyqljldy .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nkeyqljldy .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#nkeyqljldy .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#nkeyqljldy .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#nkeyqljldy .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nkeyqljldy .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#nkeyqljldy .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nkeyqljldy .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#nkeyqljldy .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nkeyqljldy .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#nkeyqljldy .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#nkeyqljldy .gt_left {\n  text-align: left;\n}\n\n#nkeyqljldy .gt_center {\n  text-align: center;\n}\n\n#nkeyqljldy .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#nkeyqljldy .gt_font_normal {\n  font-weight: normal;\n}\n\n#nkeyqljldy .gt_font_bold {\n  font-weight: bold;\n}\n\n#nkeyqljldy .gt_font_italic {\n  font-style: italic;\n}\n\n#nkeyqljldy .gt_super {\n  font-size: 65%;\n}\n\n#nkeyqljldy .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#nkeyqljldy .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#nkeyqljldy .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#nkeyqljldy .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#nkeyqljldy .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#nkeyqljldy .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#nkeyqljldy .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#nkeyqljldy .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#nkeyqljldy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"17\" class=\"gt_heading gt_title gt_font_normal\" style>Подходящие микроцели группы dl*</td>\n    </tr>\n    <tr class=\"gt_heading\">\n      <td colspan=\"17\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Сгруппированные данные по неделям</td>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"page2\">page2</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"page3\">page3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"page4\">page4</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"min3\">min3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"min6\">min6</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"min8\">min8</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl1\">dl1</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl2\">dl2</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl3\">dl3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl4\">dl4</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl5\">dl5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl6\">dl6</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl7\">dl7</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl8\">dl8</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl9\">dl9</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dl10\">dl10</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_right gt_stub\">09</th>\n<td headers=\"stub_1_1 page2\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">77</td>\n<td headers=\"stub_1_1 page3\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">28</td>\n<td headers=\"stub_1_1 page4\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">14</td>\n<td headers=\"stub_1_1 min3\" class=\"gt_row gt_right\" style=\"color: #006400;\">133</td>\n<td headers=\"stub_1_1 min6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">56</td>\n<td headers=\"stub_1_1 min8\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">41</td>\n<td headers=\"stub_1_1 dl1\" class=\"gt_row gt_right\" style=\"color: #006400;\">187</td>\n<td headers=\"stub_1_1 dl2\" class=\"gt_row gt_right\" style=\"color: #006400;\">121</td>\n<td headers=\"stub_1_1 dl3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">94</td>\n<td headers=\"stub_1_1 dl4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">71</td>\n<td headers=\"stub_1_1 dl5\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">50</td>\n<td headers=\"stub_1_1 dl6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">37</td>\n<td headers=\"stub_1_1 dl7\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">29</td>\n<td headers=\"stub_1_1 dl8\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">25</td>\n<td headers=\"stub_1_1 dl9\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">19</td>\n<td headers=\"stub_1_1 dl10\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">17</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_right gt_stub\">10</th>\n<td headers=\"stub_1_2 page2\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">89</td>\n<td headers=\"stub_1_2 page3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">51</td>\n<td headers=\"stub_1_2 page4\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">29</td>\n<td headers=\"stub_1_2 min3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">75</td>\n<td headers=\"stub_1_2 min6\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">27</td>\n<td headers=\"stub_1_2 min8\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">14</td>\n<td headers=\"stub_1_2 dl1\" class=\"gt_row gt_right\" style=\"color: #006400;\">172</td>\n<td headers=\"stub_1_2 dl2\" class=\"gt_row gt_right\" style=\"color: #006400;\">122</td>\n<td headers=\"stub_1_2 dl3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">88</td>\n<td headers=\"stub_1_2 dl4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">72</td>\n<td headers=\"stub_1_2 dl5\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">56</td>\n<td headers=\"stub_1_2 dl6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">40</td>\n<td headers=\"stub_1_2 dl7\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">36</td>\n<td headers=\"stub_1_2 dl8\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">32</td>\n<td headers=\"stub_1_2 dl9\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">28</td>\n<td headers=\"stub_1_2 dl10\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">26</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_right gt_stub\">11</th>\n<td headers=\"stub_1_3 page2\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">87</td>\n<td headers=\"stub_1_3 page3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">50</td>\n<td headers=\"stub_1_3 page4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">32</td>\n<td headers=\"stub_1_3 min3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">64</td>\n<td headers=\"stub_1_3 min6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">36</td>\n<td headers=\"stub_1_3 min8\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">26</td>\n<td headers=\"stub_1_3 dl1\" class=\"gt_row gt_right\" style=\"color: #006400;\">192</td>\n<td headers=\"stub_1_3 dl2\" class=\"gt_row gt_right\" style=\"color: #006400;\">154</td>\n<td headers=\"stub_1_3 dl3\" class=\"gt_row gt_right\" style=\"color: #006400;\">120</td>\n<td headers=\"stub_1_3 dl4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">99</td>\n<td headers=\"stub_1_3 dl5\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">84</td>\n<td headers=\"stub_1_3 dl6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">71</td>\n<td headers=\"stub_1_3 dl7\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">61</td>\n<td headers=\"stub_1_3 dl8\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">55</td>\n<td headers=\"stub_1_3 dl9\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">43</td>\n<td headers=\"stub_1_3 dl10\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">37</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_right gt_stub\">12</th>\n<td headers=\"stub_1_4 page2\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">91</td>\n<td headers=\"stub_1_4 page3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">53</td>\n<td headers=\"stub_1_4 page4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">41</td>\n<td headers=\"stub_1_4 min3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">66</td>\n<td headers=\"stub_1_4 min6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">34</td>\n<td headers=\"stub_1_4 min8\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">27</td>\n<td headers=\"stub_1_4 dl1\" class=\"gt_row gt_right\" style=\"color: #006400;\">189</td>\n<td headers=\"stub_1_4 dl2\" class=\"gt_row gt_right\" style=\"color: #006400;\">148</td>\n<td headers=\"stub_1_4 dl3\" class=\"gt_row gt_right\" style=\"color: #006400;\">121</td>\n<td headers=\"stub_1_4 dl4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">99</td>\n<td headers=\"stub_1_4 dl5\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">87</td>\n<td headers=\"stub_1_4 dl6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">70</td>\n<td headers=\"stub_1_4 dl7\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">60</td>\n<td headers=\"stub_1_4 dl8\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">54</td>\n<td headers=\"stub_1_4 dl9\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">45</td>\n<td headers=\"stub_1_4 dl10\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">39</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_right gt_stub\">13</th>\n<td headers=\"stub_1_5 page2\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">95</td>\n<td headers=\"stub_1_5 page3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">61</td>\n<td headers=\"stub_1_5 page4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">40</td>\n<td headers=\"stub_1_5 min3\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">58</td>\n<td headers=\"stub_1_5 min6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">37</td>\n<td headers=\"stub_1_5 min8\" class=\"gt_row gt_right\" style=\"color: #8B0000;\">29</td>\n<td headers=\"stub_1_5 dl1\" class=\"gt_row gt_right\" style=\"color: #006400;\">182</td>\n<td headers=\"stub_1_5 dl2\" class=\"gt_row gt_right\" style=\"color: #006400;\">150</td>\n<td headers=\"stub_1_5 dl3\" class=\"gt_row gt_right\" style=\"color: #006400;\">118</td>\n<td headers=\"stub_1_5 dl4\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">100</td>\n<td headers=\"stub_1_5 dl5\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">79</td>\n<td headers=\"stub_1_5 dl6\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">71</td>\n<td headers=\"stub_1_5 dl7\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">62</td>\n<td headers=\"stub_1_5 dl8\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">54</td>\n<td headers=\"stub_1_5 dl9\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">44</td>\n<td headers=\"stub_1_5 dl10\" class=\"gt_row gt_right\" style=\"color: #BEBEBE;\">39</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n</br>\n\n\n**Вывод**\n\nИсходя из данных нашего первичного исследования особое внимание уделим микроцелям: \n\n:::{.callout-note appearance=\"simple\" icon=false}\ndl1, dl2, dl3, dl4 — специальные JS-цели\n:::\n\nДанные цели поступают равномерно, в необходимом для нас объеме и по данным критериям подходят лучше всего, поэтому к ним особое внимание.\n\n\n:::{.callout-important title=\"Сотрудничество\"}\nЕсть проект, в котором я буду полезен? Обращайтесь! [Контакты](https://ihourglass.ru/contacts.html)\n:::\n\n\n## Корреляционный анализ\n\nПеред проведением анализа нам необходимо проверить два условия:\n\n- как распределены значения в наших целях;\n- характер взаимосвязи между целями (связь должна быть линейной). \n\nРаспределение данных покажет нам, какой метод нужно применить для корреляционного анализа, например, метод Пирсона или непараметрический метод Спирмена. \n\n::: {.callout-tip collapse=\"true\" title=\"Непараметрические методы в статистике\"}\nНепараметрические методы — это методы, которые не требуют предположений о распределении данных или о параметрах этого распределения. \n\nВ отличие от параметрических методов, которые предполагают определенную форму распределения данных, непараметрические методы позволяют анализировать данные без этих предположений. Они основаны на ранжировании данных и использовании ранговых статистик, что делает их более гибкими и устойчивыми к выбросам.\n:::\n\nХарактер взаимосвязи целей покажет, стоит ли нам вообще брать микроцель для обучения стратегии.\n\n::: {#tip-line .callout-tip collapse=\"true\" title=\"Пример линейной взаимосвязи\"}\nЛинейная взаимосвязь — это когда все наблюдаемые точки расположены максимально близко в доль выделенной линии. Если это так, то можно говорить о достаточно высокой корреляции между переменными. Например, ниже на графике мы видим стат. значимую сильную положительную корреляцию ($R=0.95$).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n\n\n\n:::\n\n### Проверка нормальности распределения значений\n\nЕсли одна из переменных (целей) распределена ненормально, тогда мы должны применить непараметрический аналог теста. В первую очередь проверим главную цель «Goals». Проверять распределение будем с помощью теста Шапиро–Уилка и визуального анализа.\n\n::: {#tip-shapiro .callout-tip collapse=\"true\" title=\"Тест Шапиро-Уилка анализирует...\"}\nТест Шапиро-Уилка анализирует нормальность распределения данных. Если $\\text{p-value}$ теста больше заданного уровня значимости (обычно $0,05$), то данные считаются нормально распределенными. \n\nЕсли же $\\text{p-value}$ меньше заданного уровня значимости, то данные отклоняются от нормального распределения. Это означает, что для анализа таких данных следует использовать методы, которые не предполагают нормальности распределения, например, непараметрические тесты.\n:::\n\nПроведем тест.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# вывод данных \nsjPlot::tab_df(\n  shapiro.test(sf$Goals),\n  title = \"Result test\",\n  footnote = \"Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\",\n  show.rownames = T,\n  digits = 5,\n  show.footnote = TRUE\n)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Result test</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">statistic</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">p.value</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">method</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">data.name</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">0.78146</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.00001</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Shapiro-Wilk normality test</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">sf$Goals</td>\n</tr>\n<tr>\n<td colspan=\"5\" style=\"font-style:italic; border-top:double black; text-align:right;\">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\nПо результатам теста делаем вывод, что наши значения по цели «Goals» *отклоняются от нормального распределения*, так как значение $\\text{p-value} < 0.05$. \n\nПроведем визуальный анализ распределения значений по этой же цели.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# подготовим данные из основного фрейма\ncor_df <- df |> \n  filter(Date >= \"2024-02-24\") %>% \n  select(2:ncol(.)) |> \n  relocate(Goals)\n\n# замена NA на 0\ncor_df[is.na(cor_df)] <- 0\n\n## гистограма и плотность через библиотеку ggplot\nggplot(cor_df, aes(x = Goals))+\n  geom_histogram(\n    aes(y = after_stat(density)), \n    fill = \"#ff79c6\", \n    col = \"gray30\",\n    bins = 5\n    ) +\n  geom_density(col = \"gray30\", lwd = .5) +\n  \n  scale_x_continuous() + \n  \n  theme_minimal() +\n  \n  labs(\n    title = \"Значения в главной цели имеют дискретное пуассоновское распределение\",\n    caption = \"Данные API Директ + собственные расчеты\",\n    x = \"Goals\",\n    y = \"Density\"\n    ) +\n  \n  theme(\n    plot.title    = element_text(size = 12, color = \"gray40\"),\n    plot.caption  = element_text(size = 8, color = \"gray40\"),\n    axis.title    = element_text(size = 10, color = \"gray40\"),\n    axis.line     = element_line(colour = \"gray40\"),\n    panel.grid    = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/density-1.png){width=960}\n:::\n:::\n\n\nРассмотрим как распределены наши значения в разрезе недель.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n## сравниваем распределения\n\ndf |> \n  mutate(Week = clock::date_format(Date, format = \"%W\")) |> \n\n  ggplot(aes(Goals, fill = Week)) +\n  geom_rug() +\n  geom_density(alpha = 0.7) +\n\nscale_x_continuous(breaks = seq(0,10,1)) +\n\n  \n  theme_minimal() +\n  \n  labs(\n    title = \"Распределение значений по главной цели в разрезе недель\",\n    x = \"Goals\",\n    y = \"Density\"\n    ) +\n  \n   theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 7, color = \"gray50\"),\n    panel.grid = element_blank(),\n    axis.line = element_line(colour = \"gray40\"),\n    legend.position = \"top\",\n    legend.justification = \"left\",\n    legend.box.spacing = unit(0.1, \"cm\"),\n    legend.title = element_text(size = 10, color = \"gray50\"), \n    legend.text = element_text(size = 8, color = \"gray50\"), \n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/density by week-1.png){width=960}\n:::\n:::\n\n\n\n**Вывод**\n\nЗначения в главной цели распределены ненормально, а это значит, корреляционный анализ будет проводиться методом Спирмана. \n\nЕсли честно, то данное условие можно назвать желательным, но необязательным. На практике значения, полученные различными методами, не сильно отличаются, если только у вас не экстремально малое кол-во наблюдений. Гораздо важнее взаимосвязь макро- и микроцелей.\n\n\n\n\n### Проверка взаимосвязи между целями\n\nНапомню, что одно из требований к корреляционному анализу — это линейная взаимосвязь переменных (@tip-line). Проверим на графике, как связаны наши цели между собой.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\npairs(\n  cor_df[, c(1, 6:21)],\n  gap = 0, \n  upper.panel = NULL, \n  font.labels = 3, \n  lower.panel = panel.smooth, \n  cex = 0.5, \n  cex.labels = 1,\n  main = \"Нет линейной взаимосвязи между целью «Goals» и микроцелями\"\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n**Результат**\n\nНа графике видим, что наша главная цель имеет нелинейную взаимосвязь со всеми микроцелями (идём глазами вниз по колонке «Goals»). Это значит:\n\n- что наша главная цель имеет слабую взаимосвязь с микроцелями (об этом нам также скажет коэффициент детерминации при проведении корреляционного и регрессионного анализов). \n- Есть большая вероятность, что нам не подойдет ни одна микроцель для обучения стратегии показов.\n\n\n\n\n### Проводим корр. анализ\n\nПробуем провести корреляционный анализ непараметрическим методом Спирмена с поправкой на множественные сравнения Бенджамини — Хохберга, так как у нас много переменных для сравнения.\n\n\n::: {.callout-tip collapse=\"true\" title=\"Проблема множественных сравнений\"}\nПроблема множественных сравнений (multiple comparisons problem) в статистике возникает, когда одновременно анализируется большое количество статистических выводов или оценивается подмножество параметров, выбранных на основе наблюдаемых значений. То есть возрастает групповая вероятность ошибки первого рода (family-wise error rate) — вероятность ошибки первого рода для хотя бы одной из множества гипотез. \n\nЧем больше количество сделанных выводов, тем выше вероятность обнаружения ложных корреляций или различий между группами. Это связано с тем, что при большом количестве сравнений увеличивается вероятность случайного обнаружения статистически значимых результатов, даже если они не имеют реального значения. \n\nНапример, если вы коррелируете 17 переменных друг с другом (это наш случай), то вы проверяете 136 гипотез о связи. Пять процентов из этих гипотез, то есть в среднем 6–7 гипотез у вас будут статистически значимыми, даже если никаких эффектов на самом деле нет! \n\nПоэтому, если проверяется сразу много гипотез, то необходимо применять поправки на множественные сравнения. Эти поправки позволяют контролировать групповую вероятность ошибки первого рода на желаемом уровне.\n:::\n\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# создаем матрицу p-value\ndf_psych <- cor_df |>  \n  psych::corr.test(adjust = \"BH\", method = \"spearman\")\n\n\n# создаем график\nggcorrplot::ggcorrplot(\n  corr = df_psych$r,\n  hc.order = FALSE,\n  type     = \"lower\",\n  method   = \"square\",\n  lab      = TRUE,\n  lab_size = 2,\n  p.mat    = df_psych$p,\n  pch.cex = 8,\n  tl.cex   = 8,\n  pch.col  = \"red\",\n  title = \"Наблюдаме статистически значимую связь у целей «dl*»\",\n  outline.color = \"white\",\n  lab_col = \"gray20\",\n  show.diag = TRUE\n  ) + \n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.text = element_text(color = \"gray50\"),\n    axis.text.x = element_text(angle = 90),\n    panel.grid = element_blank()\n    )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/corr plot without NA-1.png){width=960}\n:::\n:::\n\n\nНа что тут смотреть? Находим строку «Goals» на оси ординат ($y$) и идем взглядом по оси абсцисс. В первую очередь отбрасываем микроцели, которые перечеркнуты красным крестиком, — данные не прошли уровень $\\alpha$, т. е. статистически не значимы. Далее смотрим на силу связи по коэффициенту «Corr» — чем краснее и чем больше коэффициент, тем лучше. \n\n\n**Вывод**\n\nМикроцель «dl9» имеет наилучшие показатели по коэффициенту корреляции, но у неё небольшое количество достижений целей, в среднем 36. Поэтому **обратим внимание на цель «dl6»** (в среднем 58 в неделю).\n\nОднако есть одно существенное «но»! Дело в том, что микроцель имеет коэффициент корреляции, равный $0,47$, и если мы рассчитаем коэффициент детерминации $R^2$ по формуле $R^2 = 0,47^2$, то получим значение 0.22. Т. е. наша микроцель объясняет всего $22\\%$ дисперсии (изменчивости) главной цели. Это очень низкий показатель, и в целом я бы не стал брать такую цель для тестов.\n\n::: {.callout-tip collapse=\"true\" title=\"Коэффициент детерминации\"}\nКоэффициент детерминации ($R^2$) в статистике — это мера, которая показывает, насколько хорошо выбранная модель объясняет изменчивость данных. Он представляет собой долю дисперсии зависимой переменной, которая объясняется рассматриваемой моделью. Проще говоря, это процент вариации зависимой переменной (в нашем случае цель «Goals»), который может быть объяснен изменениями в независимой переменной (микроцель «dl6»).\n\nКоэффициент детерминации принимает значения от $0$ до $1$, где $0$ означает, что модель не объясняет никакой изменчивости данных, а $1$ указывает на то, что модель полностью объясняет все изменения в зависимой переменной. Чем ближе значение $R^2$ к $1$, тем лучше модель соответствует данным.\n:::\n\n\n\n\n## Регрессионый анализ\n\nНа самом деле [корреляционный анализ это частный случай простой линейной регрессионой модели](https://lindeloev.github.io/tests-as-linear/). \n\nТо есть у нас уже есть все необходимые данные для принятия решения. Так зачем нужен регрессионный анализ?\n\nВо-первых, мы сможем предсказывать значения в случае, если у нас микроцель имеет высокий коэффициент детерминации. Тем самым понять, устраивает ли нас результат по достижению главных целей или нет.\n\nВо-вторых, если значение коэф. детерминации низкое, то мы можем попробовать найти связку микроцелей, которые будут хорошо объяснять изменчивость главной цели. Это большая и сложная тема, о которой я напишу в отдельной статье.\n\n\n\n\n### Допущения\n\nКак и с другими параметрическими методами, линейная регрессия имеет определенные допущения относительно используемых данных. Если они не соблюдаются, то все наши расчеты уровня значимости могут быть некорректными.\n\nДля проведения регрессионного анализа наши данные должны соблюдать ряд требований:\n\n- линейная взаимосвязь переменных;\n- гомоскедастичность:\n  - нормальное распределение остатков;\n  - разброс ошибок — постоянная изменчивость остатков на всех уровнях независимой переменной.\n- данные не должны содержать выбросы.\n\n\n\n\n### Проверка на линейность\n\nКак отметили выше, необходимо, чтобы наша микроцель имела линейную взаимосвязь и объясняла как можно большую долю дисперсии (изменчивости) главной цели. Однако в ходе тестов выяснилось, что главная цель «Goals» не имеет линейной связи ни с одной из микроцелей. Что делать? Рассмотрим данные.\n\nНиже на графике показан характер взаимосвязи главной цели «Goals» и интересующей нас микроцели «dl6» с группировкой по дням.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# подготовим данные\nlm_df <- df |> \n  filter(Date >= \"2024-02-24\") %>% \n  select(2:ncol(.)) |> \n  relocate(Goals)\n\n# замена NA на 0\nlm_df[is.na(lm_df)] <- 0\n\n\n# строим график\nggplot(lm_df, aes(x = dl6, y = Goals)) + \n  geom_point(color = \"gray50\") + \n  geom_smooth(\n    method = 'loess', \n    color = \"gray40\", \n    linetype = \"dashed\", \n    size = .6, \n    se = FALSE\n    ) +\n\n  geom_smooth(method = 'lm', color = \"#ff79c6\", se = FALSE) +\n\n  ggpubr::stat_cor(\n    label.sep = \"\\n\",\n    label.x = 1,\n    label.y = 4,\n    color = \"gray40\"\n  ) +\n\nstat_regline_equation(\n    aes(label =  paste(..eq.label.., ..rr.label.., sep = \"~~~~\")),\n        color = \"gray40\",\n        label.x = 1,\n        label.y = 3.7\n  ) +\n  \n  scale_x_continuous(breaks = seq(0, 20, 1)) +\n\n  theme_minimal()+\n  \n  labs(\n    title = \"Нелинейная связь\",\n    x = \"Микроцель: «dl6»\",\n    y = \"Цель: Goals\"\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 8, color = \"gray50\"),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n</br>\n\nНа графике видно, что с увеличением числа микроцелей мы все равно можем получить от 0 до 4 главных конверсий. То есть явно не видно, что с увеличением числа микроцелей увеличивается число главных целей. \n\nВ данном случае получается некий диапазон работы рекламной системы, который можно измерить с помощью контрольных карт Шухарта. Замерив диапазон, можем узнать мощность нашей рекламной системы и уже на основе этих данных ставить реальные KPI для исполнителей.\n\n:::{.callout-tip title=\"Контрольные карты\"}\nО контрольных картах я подробно написал в статье: [Применяем ГОСТ стандарт РФ «Контрольные карты Шухарта» для оптимизация рекламных кампаний и других источников трафика](https://ihourglass.ru/wiki/shewhart_control_card_ydirect.html)\n:::\n\nПопробуем сгруппировать наши данные по неделям.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# подготовим данные\nlm_df_w <- df |> \n  filter(Date >= \"2024-02-26\") |> \n  mutate(\n    Week = clock::date_format(Date, format = \"%W\"),\n    across(where(is.numeric), \\(x) replace_na(x, 0))\n    ) |> \n  reframe(across(where(is.numeric), sum), .by = Week)\n\n\n# строим график\nggplot(lm_df_w, aes(x = dl6, y = Goals)) + \n  geom_point(color = \"gray50\") + \n  geom_smooth(\n    method = 'loess', \n    color = \"gray40\", \n    linetype = \"dashed\", \n    linewidth = .6, \n    se = FALSE\n    ) +\n\n  geom_smooth(method = 'lm', color = \"#ff79c6\", se = FALSE) +\n\n    ggpubr::stat_cor(\n    label.sep = \"\\n\",\n    label.x = 1,\n    label.y = 15,\n    color = \"gray40\"\n  ) +\n\nstat_regline_equation(\n    aes(label =  paste(..eq.label.., ..rr.label.., sep = \"~~~~\")),\n        color = \"gray40\",\n        label.x = 1,\n        label.y = 14\n  ) +\n\n  theme_minimal() +\n  \n  # scale_x_continuous(breaks = seq(0, 30, 1)) +\n  \n  labs(\n    title = \"Почти линейная, но не совсем\",\n    x = \"Микроцель: «dl6»\",\n    y = \"Цель: Goals\"\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 8, color = \"gray50\"),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\nСгруппировав данные по неделям, смогли объяснить 56% изменчивости главной цели, но при этом уровень $\\text{p-value}$ ухудшился и стал на уровне статистической тенденции, т. е. стал очень близок к тому, что мы не сможем отвергнуть нулевую гипотезу — независимости зависимой переменной «Goals» от предиктора «dl6». \n\nПроще, проверяется допущение о том, что наши переменные никак не связаны между собой, и если значение $\\text{p-value}$ близко к 0,05, то это действительно может быть так. А если нет связи, значит, мы никак не сможем влиять на главную цель через микроцель.\n\n**Вывод**\n\nПри анализе данных по дням линейной взаимосвязи не наблюдается, однако при группировке данных по неделям связь прослеживается, но с оговорками. Т. е. чисто математически связь улучшается, но насколько это верное решение, возможно выяснить только с помощью тестирования.\n\nПроверим остальные критерии.\n\n\n\n\n### Гомоскедастичность\n\nОстатки должны быть нормально распределены, а разброс ошибок должен не уменьшаться и не увеличиваться в зависимости от предсказанных значений. Это то, что называется гомоскедастичностью или гомогенностью (когда всё хорошо) и гетероскедастичностью или гетерогенностью (когда всё плохо).\n\n\n\n\n#### Распределение остатков\n\nРаспределение остатков проверим либо с помощью теста Бартлетта, либо теста Левина. Проведем оба теста, сгруппировав данные по неделям, плюс визуализируем результаты. Обращаем внимание на значение $\\text{p-value}$ (@tip-shapiro).\n\n> **Тест Бартлетта для главной цели «Goals»**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# подготовим данные к анализу\ntest_df <- df |> \n  filter(Date >= \"2024-02-26\") |> \n  mutate(\n    Week = clock::date_format(Date, format = \"%W\"),\n    across(where(is.numeric), \\(x) replace_na(x, 0)),\n    Week = as.factor(Week)\n    ) |> \n  slice(1:49)\n\n# тест и вывод данных \nsjPlot::tab_df(\n  bartlett.test(Goals ~ Week, test_df),\n  title = \"Test Result\",\n  show.rownames = T,\n  digits = 3\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Test Result</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">statistic</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">parameter</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">p.value</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">data.name</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">method</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">3.425</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.754</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Goals by Week</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Bartlett test of homogeneity of variances</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\n> **Тест Левина**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# тест и вывод данных \nsjPlot::tab_df(\n  with(test_df, car::leveneTest(Goals, Week)),\n  title = \"Test Result\",\n  show.rownames = T,\n  digits = 3\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Test Result</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">Row</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">Df</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">F.value</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">Pr..F.</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">group</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.737</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.623</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \"> </td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">42</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">NA</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">NA</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\n> **Тест Бартлетта для микроцели «dl6»**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# тест и вывод данных \nsjPlot::tab_df(\n  bartlett.test(dl6 ~ Week, test_df),\n  title = \"Test Result\",\n  show.rownames = T,\n  digits = 3\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Test Result</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">statistic</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">parameter</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">p.value</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">data.name</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">method</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">2.531</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.865</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">dl6 by Week</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Bartlett test of homogeneity of variances</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\nВизуальный анализ распределения остатков.\n\n\n::: {.cell .column-body-outset}\n\n```{.r .cell-code}\nmodel  <- lm(Goals ~ Week, test_df)\n\ntest_df$res <- model$residuals\ntest_df$fit <- model$fitted.values\ntest_df$obs_num <- 1:nrow(test_df)\n\n\n## normality of variables distributions\npl_err1 <- ggplot(\n  test_df, \n  aes(x = res)\n  ) +\n  \n  geom_histogram(\n    aes(y = after_stat(density)), \n    fill = \"#ff79c6\", \n    col = \"gray30\",\n    bins = 5\n    ) +\n  \n  geom_density(col = \"gray30\", lwd = .5) +\n  \n  scale_x_continuous() + \n  \n  theme_minimal() +\n  \n  labs(\n    title = \"Остатки имеют тенденцию к нормальному распределению\",\n    x = \"Residues\",\n    y = \"Density\"\n    ) +\n  \n  theme(\n    plot.title = element_text(size = 12, color = \"gray40\"),\n    \n    axis.title = element_text(size = 10, color = \"gray40\"),\n    axis.line = element_line(colour = \"gray40\"),\n    \n    panel.grid = element_blank()\n  )\n\n\n## normality of variables distributions 2\npl_err2 <- ggplot(\n  test_df, \n  aes(x = res, y = Date)\n  ) + \n  \n  geom_jitter(\n    width = 0.1,\n    alpha = 0.5\n     ) +\n  \n  geom_vline(xintercept = 0, col = 'red') +\n  \n  theme_minimal() +\n  \n  labs(\n    x = \"Residues\",\n    y = NULL\n    ) +\n  \n  theme(\n    axis.title = element_text(size = 10, color = \"gray40\"),\n    axis.line = element_line(colour = \"gray40\"),\n\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n\n# объедением два графика\npl_err1 + pl_err2\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n**Вывод**\n\nВсе тесты показали тенденцию к нормальному распределению остатков, так как в тестах $\\text{p-value}$ больше значения 0,05.\n\n\n\n\n#### Разброс ошибок\n\nСоздадим график зависимости ошибок от предсказанных значений.\n\n\n::: {.cell .column-body-outset}\n\n```{.r .cell-code}\n# Homoscedasticity\nggplot(test_df, aes(x = fit, y = res)) + \n  geom_point(size = 2, color = \"gray50\") + \n  geom_hline(yintercept = 0, col = 'red') +\n  theme_minimal() +\n   \n  labs(\n    title = \"Данные симметричны относительно нижней и верхней части графика\",\n    x = \"Fitted\",\n    y = \"Residuals\"\n    ) +\n  \n  theme(\n    plot.title = element_text(size = 14, color = \"gray40\"),\n    \n    axis.title = element_text(size = 10, color = \"gray40\"),\n    axis.line = element_line(colour = \"gray40\"),\n    \n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n\nНа что здесь смотреть? На симметричность относительно нижней и верхней части графика, на то, что разброс примерно одинаковый слева и справа. В данном случае всё в порядке.\n\n\n**Вывод**\n\nТребования гомоскедастичности соблюдены. Все тесты показывают, что мы можем провести классический регрессионный анализ данных с одной объясняющей переменной «dl6».\n\n\n\n\n### Влияние выбросов на регрессионную модель\n\nСначала рассмотрим значения по всем целям без группировки по неделям через график «ящик с усами» (boxplot) с целью обнаружить выбросы в данных.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbox_plot <- test_df |>  \n  pivot_longer(\n    cols = c(2:22),\n    names_to = \"name\",\n    values_to = \"value\")\n\n\nggplot(\n  box_plot, \n  \n  aes(\n    x = name, \n    y = value\n  )\n) + \n  \n  geom_boxplot(\n    fill = \"dodgerblue1\",\n    colour = \"black\",\n    alpha = 0.5,\n    outlier.colour = \"tomato2\"\n  ) + \n  \n  theme_void() +\n  \n  labs(\n    x = NULL,\n    y = NULL\n  ) +\n  \n  theme(\n    axis.title = element_text(size = 10, color = \"gray50\"),\n    axis.text = element_text(size = 9, color = \"gray50\"),\n    axis.text.x = element_text(angle = 90),\n\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/unnamed-chunk-26-1.png){width=960}\n:::\n:::\n\n\nУ целей «Goal» и «dl6» нет экстремальных значений, поэтому для наглядности примера возьмём цели «Calls» и «dl1».\n\nДавайте теперь попробуем посмотреть, как изменится модель, если выкинуть экстремальные значения по микроцели «dl1» и что будет, если выкинуть экстремальные значения по главной цели «Calls». \n\n- Красная линия - регрессионная прямая для модели со всеми точками.\n- Зелёная линия - регрессионная прямая для модели без экстремальных значений по предиктору «dl1».\n- Голубая линия - регрессионная прямая для модели без экстремальных значений по предсказываемой переменной «Calls».\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# подготовим данные к анализу\nexamp_df <- df |> \n  filter(Date >= \"2024-02-26\") |> \n  mutate(\n    across(where(is.numeric), \\(x) replace_na(x, 0))\n  )\n\n# функция для исключения выбросов\nis_outlier <- function(x, n = 2, centr = mean, vary = sd) {\n  (x > centr(x) + n * vary(x)) | (x < centr(x) - n * vary(x))\n}\n\n# записываем результат работы функции в дата фрейм\nexamp_df <- examp_df %>%\n  mutate(\n    dl_outlier = is_outlier(dl1),\n    calls_outlier = is_outlier(Calls)\n  )\n\n# модель без выбросов по оси x\nmodel_without_outliers_by_x <- examp_df %>%\n  filter(!dl_outlier) %>%\n  lm(formula = Calls ~ dl1)\n\n# модель без выбросов по оси y\nmodel_without_outliers_by_y <- examp_df %>%\n  filter(!calls_outlier) %>%\n  lm(formula = Calls ~ dl1)\n\n# полная модель\nmodel <- examp_df %>%\n  lm(formula = Calls ~ dl1)\n\n# строим график\nggplot(\n  data = examp_df, \n  aes(\n    x = dl1,\n    y = Calls,\n    shape = dl_outlier,\n    colour = calls_outlier\n  )\n) +\n  \n  geom_point(alpha = 0.3) +\n  \n  geom_abline(\n    intercept = model$coefficients[1], \n    slope = model$coefficients[2],\n    color = \"tomato2\"\n  ) +\n  \n  geom_abline(\n    intercept= model_without_outliers_by_x$coefficients[1], \n    slope = model_without_outliers_by_x$coefficients[2],\n    color = \"forestgreen\"\n    \n  ) +\n  \n  geom_abline(\n    intercept= model_without_outliers_by_y$coefficients[1], \n    slope = model_without_outliers_by_y$coefficients[2], \n    color = \"dodgerblue1\"\n  ) +\n  \n  stat_regline_equation(\n    aes(label =  paste(after_stat(eq.label), sep = \"~~~~\")),\n    label.x = 3\n  ) +\n  \n  # scale_x_continuous(expand = c(0, 10), breaks = seq(10, 100, 10)) +\n  # scale_y_continuous(expand = c(1, -1), breaks = seq(-3, 5, 1)) +\n  \n  theme_minimal() +\n  \n  labs(\n    title = \"Значимо на модель влияет предиктор «dl1»\",\n    x = \"Микроцель: «dl1»\",\n    y = \"Цель: «Calls»\"\n    \n  ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    \n    axis.title = element_text(size = 8, color = \"gray50\"),\n    axis.text = element_text(size = 7, color = \"gray50\"),\n    \n    panel.grid = element_blank(),\n    \n    legend.position = \"top\",\n    legend.justification = \"left\",\n    legend.box.spacing = unit(0.1, \"cm\"),\n    legend.text = element_text(size = 8, color = \"gray50\"), \n    legend.title = element_text(size = 9, color = \"gray40\"), \n    \n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/reg line and extreme value-1.png){width=960}\n:::\n:::\n\n\n\n**Итог**\n\nНа этом графике мы видим, что значения предиктора «dl1», отмеченные зелёной линией, оказывают наибольшее влияние на регрессионную модель. Они в значительной степени определяют наклон микроцели.\n\nЭто означает, что при работе с данными целями необходимо учитывать влияние выбросов на модель. Выбросы могут исказить результаты моделирования и привести к неверным значениям.\n\n:::{.callout-tip title=\"Уравнение регрессии\" collapse=\"true\"}\nУравнение регрессии: \n\n$$\\large y = a + bx$$\n\n- $\\large y$ — зависимая переменная (Goals), \n- $\\large a$ — отрезок, отсекаемый этой линией на оси Y (то есть значение y, когда x = 0), \n- $\\large b$ — коэффициент наклона линии, \n- $\\large x$ — объясняющая (независимые или управляющие) переменная (dl1). \n\nКоэффициент наклона $b$ найденной нами линии описывает «наилучшую» линейную зависимость между Calls и dl1 для соответствующей выборки, который определяется стандартным методом наименьших квадратов (МНК).\n:::\n\n\n\n\n### Простая линейная регрессия\n\nСоздадим классическую линейную регрессионную модель, где в качестве объясняемой (зависимой) переменной будет главная цель «Goals», а в качестве объясняющей переменной (предиктор) микроцель «dl6». А затем посмотрим, как модель работает на предсказательных значениях выбранной микроцели.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# подготовим данные\nlm_df_w <- df |> \n  filter(Date >= \"2024-02-26\") |> \n  mutate(\n    Week = clock::date_format(Date, format = \"%W\"),\n    across(where(is.numeric), \\(x) replace_na(x, 0))\n    ) |> \n  reframe(across(where(is.numeric), sum), .by = Week)\n\n# создаем модель\nmodel <- lm(Goals ~ dl6, data = lm_df_w)\n\n# выводим данные на страницу в красивом виде\nstargazer::stargazer(\n  model,     \n  type = \"text\",\n  style = \"default\",\n  title=\"Regression Results\", \n  single.row = TRUE\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n===============================================\n                        Dependent variable:    \n                    ---------------------------\n                               Goals           \n-----------------------------------------------\ndl6                       0.147** (0.053)      \nConstant                   0.669 (2.854)       \n-----------------------------------------------\nObservations                     8             \nR2                             0.564           \nAdjusted R2                    0.491           \nResidual Std. Error       3.121 (df = 6)       \nF Statistic             7.756** (df = 1; 6)    \n===============================================\nNote:               *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n</br>\n\nРассмотрим результаты. Коэффициент предиктора «dl6» означает, насколько увеличивается значение цели «Goals», если увеличить значение микроконверсии на $1$ единицу: на $0.147$. Не очень много! Поэтому микроконверсий должно быть много для обучения стратегий. \n\nЕсли выставить значение $dl6 = 0$, то это позволяет понять, что такое $intercept$ модели (в выводе записана как $constant$) — это значение зависимой переменной «Goals» в случае, если предиктор «dl6» равен нулю.\n\nВизуализируем модель на графике.\n\n\n::: {.cell .fig-column-body-outset}\n\n```{.r .cell-code}\n# диаграмма рассеяния\nlm_plt <- ggplot(\n  data = lm_df_w,\n  aes(x = dl6, y = Goals)) +\n  geom_point(alpha = 0.5) +\n  geom_abline(\n    slope = model$coefficients[2], \n    intercept = model$coefficients[1],\n    color = \"red\",\n    alpha = 0.5\n    ) +\n  \n  stat_regline_equation(\n    aes(label =  paste(after_stat(eq.label), sep = \"~~~~\")),\n    label.x = 3,\n    color = \"gray40\"\n  ) +\n\n  # scale_x_continuous(breaks = seq(0,30,1))+\n  # scale_y_continuous(breaks = seq(0,5,1))+\n\n  theme_minimal() +\n   \n  labs(\n    title = \"Реггресионная прямая\",\n    x = \"Микроцель: «dl6»\",\n    y = \"Цель: «Goals»\"\n    ) +\n  \n  theme(\n    plot.title  = element_text(size = 12, color = \"gray40\"),\n    axis.title = element_text(size = 10, color = \"gray50\"),\n    axis.text = element_text(size = 8, color = \"gray50\"),\n    panel.grid = element_blank(),\n    plot.margin = ggplot2::margin(\n      t = 0.3,\n      r = 0.3, \n      b = 0.3,\n      l = 0.3, \n      \"cm\"\n      )\n  )\n\nlm_plt\n```\n\n::: {.cell-output-display}\n![](correlatio_files/figure-html/reg line-1.png){width=960}\n:::\n:::\n\n\n</br>\n\nНа графике изображена регрессионная прямая, которая наилучшим образом описывает взаимосвязь между нашими переменными. Также на графике изображена формула нашей прямой. Линия направлена вверх, что означает положительную связь, т. е. с увеличением микроцелей увеличивается кол-во макроцелей. \n\nТеперь создадим модель для несгруппированных данных по неделям для сравнения результатов.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# подготовим данные\nlm_df <- df |> \n  filter(Date >= \"2024-02-24\") %>% \n  select(2:ncol(.)) |> \n  relocate(Goals) |> \n  mutate(\n    across(where(is.numeric), \\(x) replace_na(x, 0))\n    )\n\n# создаем модель\nmodel2 <- lm(Goals ~ dl6, data = lm_df)\n\n# выводим данные на страницу в красивом виде\nstargazer::stargazer(\n  model2,     \n  type = \"text\",\n  style = \"default\",\n  title=\"Regression Results\", \n  single.row = TRUE\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n===============================================\n                        Dependent variable:    \n                    ---------------------------\n                               Goals           \n-----------------------------------------------\ndl6                      0.191*** (0.043)      \nConstant                  -0.217 (0.363)       \n-----------------------------------------------\nObservations                    52             \nR2                             0.283           \nAdjusted R2                    0.268           \nResidual Std. Error       1.018 (df = 50)      \nF Statistic           19.687*** (df = 1; 50)   \n===============================================\nNote:               *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n**Вывод**\n\nМикроцель «dl6» объясняет 56% дисперсии главной цели «Goals», если данные сгруппированы по неделям, и 28%, если данные не сгруппированы. Это, скажем так, низкие показатели. Значит, есть еще какие-то параметры, которые входят в главную цель, которые способны дополнить нашу модель и лучше объяснить главную цель. Для этого необходимо продолжать поиск микроцелей или их сочетание. Возможно, другие регрессионные модели смогут лучше объяснить изменчивость главной цели, например, множественный, аддитивный или смешанные. \n\n\n\n\n### Прогноз значений\n\nПредскажем кол-во достижения целей «Goals», если будет достигнуто среднее кол-во микроцелей «dl6». Подставим значение по микроцели в уравнение прямой $y=0.67+0.15x$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- lm(Goals ~ dl6, data = lm_df_w)\n\nm_dl <- lm_df_w |> \n  mutate(Week = as.numeric(Week))\n\npred <- round(mean(m_dl$dl6))\n\nfit <- predict(model, newdata = data.frame(dl6 = pred))\n```\n:::\n\n\n**Вывод**\n\nВ итоге при среднем значении микроцели «dl6» 50 мы должны получить 8 целей. В целом, учитывая специфику ниши, такое значение нас устраивает.\n\nПроверим эту цель на практике, и если она не даст результатов, то будем искать связки микроцелей, с помощью которых построим более сложные модели, которые смогут объяснить большую часть дисперсии по главной цели.\n\n\n\n\n## Итоги\n\nВ ходе корреляционного анализа мы нашли статистически значимые микроцели группы «dl*». Но у этих целей низкий коэффициент детерминации. Это значит, что, скорее всего, мы не сможем обучить нашу стратегию, и результаты будут непредсказуемы. Но так как на данный момент у нас нет других подходящих микроцелей, то проведем тесты с тем, что есть.\n\nДалее необходимо: \n\n1. Составить журнал тестирования микроцелей. \n2. Собрать данные в течение 1–2 недель. \n3. Провести post-hoc тесты и по итогам определить следующий шаг.\n\n:::{.callout-important title=\"Важно\"}\nПосле обучения стратегии на микроцелях необходимо провести апостериорные (post-hoc) тесты для определения статистически значимого результата, т. е. мы определим, действительно ли применяемые микроцели статистически значимо улучшили результат: обращений в компанию стало больше. \n\n[Вторая часть](/wiki/correlatio_part_2_new_statistics.html) статьи будет о том, как провести апостериорные тесты (post hoc) для подтверждения того, что наша микроконверсия действительно принесла больше главных целей.\n:::\n\n:::{.callout-tip title=\"Сотрудничество\"}\nЕсть проект, в котором я буду полезен? Обращайтесь! [Контакты](https://ihourglass.ru/contacts.html)\n\nПодписывайтесь нам мой ТГ-канал [DDM & Ads](https://t.me/data_driven_ads)\n:::",
    "supporting": [
      "correlatio_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<script src=\"../site_libs/jszip-1.13.6/jszip.min.js\"></script>\n<link href=\"../site_libs/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.html5.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.print.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<script src=\"../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\n<script src=\"../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<link href=\"../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}